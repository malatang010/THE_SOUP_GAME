const __vite__fileDeps=["assets/index-BPVoLLHE.js","assets/index-DofCypRY.js","assets/index-B-4sXFVt.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{u as $c,v as ni,o as Nc,w as X,t as Sr,r as Dc,x as l0,y as Bl,z as Gl,A as qc,C as Ia,D as f0,p as ca,E as _i,V as p0,M as d0,N as B,F as g0,G as wc,J as y0,K as v0,L as m0,O as Fh,P as w0,Q as _0,R as b0,S as Bh,$ as E0,T as I0,U as x0,W as Ws,X as Gh,Y as P0,Z as S0,a0 as Lc,a1 as Wl,a2 as qr,a3 as O0,a4 as Wh,a5 as ps,a6 as St,a7 as kt,a8 as wi,a9 as ar,aa as R0,ab as ds,ac as Jl,ad as A0,ae as C0,af as T0,ag as Ql,ah as $0,ai as Yl,aj as Zl,ak as ys,al as _c,am as ya,an as vs,ao as N0,ap as va,aq as D0,ar as q0,as as L0,at as j0,au as ua,av as z0,aw as M0,ax as ic,ay as Jh,az as U0,aA as H0,aB as k0,aC as Qh,aD as K0,aE as V0,aF as F0,aG as B0,aH as G0,aI as W0,aJ as J0,aK as Fs,aL as Xl,aM as sc,aN as Q0,aO as Y0,_ as Z0}from"./index-DofCypRY.js";import{s as Zs,a as xa,r as ef,f as Hi,g as jc,i as Lr,b as Xs,c as Yh,d as X0,e as ew,h as zc,p as tw,j as Mc,k as Pa,l as mi,m as rw,n as Ii}from"./index.es-B0u8-C1H.js";const iw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,sw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,nw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function aw(o,t){if(o==="__proto__"||o==="constructor"&&t&&typeof t=="object"&&"prototype"in t){ow(o);return}return t}function ow(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function ha(o,t={}){if(typeof o!="string")return o;const r=o.trim();if(o[0]==='"'&&o.endsWith('"')&&!o.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!nw.test(o)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(iw.test(o)||sw.test(o)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,aw)}return JSON.parse(o)}catch(s){if(t.strict)throw s;return o}}function cw(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function qt(o,...t){try{return cw(o(...t))}catch(r){return Promise.reject(r)}}function uw(o){const t=typeof o;return o===null||t!=="object"&&t!=="function"}function hw(o){const t=Object.getPrototypeOf(o);return!t||t.isPrototypeOf(Object)}function ma(o){if(uw(o))return String(o);if(hw(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return ma(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function tf(){if(typeof $c===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const bc="base64:";function lw(o){if(typeof o=="string")return o;tf();const t=$c.from(o).toString("base64");return bc+t}function fw(o){return typeof o!="string"||!o.startsWith(bc)?o:(tf(),$c.from(o.slice(bc.length),"base64"))}function nr(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function pw(...o){return nr(o.join(":"))}function la(o){return o=nr(o),o?o+":":""}const dw="memory",gw=()=>{const o=new Map;return{name:dw,options:{},hasItem(t){return o.has(t)},getItem(t){return o.get(t)??null},getItemRaw(t){return o.get(t)??null},setItem(t,r){o.set(t,r)},setItemRaw(t,r){o.set(t,r)},removeItem(t){o.delete(t)},getKeys(){return Array.from(o.keys())},clear(){o.clear()},dispose(){o.clear()}}};function yw(o={}){const t={mounts:{"":o.driver||gw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=g=>{for(const _ of t.mountpoints)if(g.startsWith(_))return{base:_,relativeKey:g.slice(_.length),driver:t.mounts[_]};return{base:"",relativeKey:g,driver:t.mounts[""]}},s=(g,_)=>t.mountpoints.filter(S=>S.startsWith(g)||_&&g.startsWith(S)).map(S=>({relativeBase:g.length>S.length?g.slice(S.length):void 0,mountpoint:S,driver:t.mounts[S]})),a=(g,_)=>{if(t.watching){_=nr(_);for(const S of t.watchListeners)S(g,_)}},u=async()=>{if(!t.watching){t.watching=!0;for(const g in t.mounts)t.unwatch[g]=await Zh(t.mounts[g],a,g)}},f=async()=>{if(t.watching){for(const g in t.unwatch)await t.unwatch[g]();t.unwatch={},t.watching=!1}},y=(g,_,S)=>{const R=new Map,D=C=>{let Z=R.get(C.base);return Z||(Z={driver:C.driver,base:C.base,items:[]},R.set(C.base,Z)),Z};for(const C of g){const Z=typeof C=="string",se=nr(Z?C:C.key),ne=Z?void 0:C.value,ce=Z||!C.options?_:{..._,...C.options},ae=r(se);D(ae).items.push({key:se,value:ne,relativeKey:ae.relativeKey,options:ce})}return Promise.all([...R.values()].map(C=>S(C))).then(C=>C.flat())},m={hasItem(g,_={}){g=nr(g);const{relativeKey:S,driver:R}=r(g);return qt(R.hasItem,S,_)},getItem(g,_={}){g=nr(g);const{relativeKey:S,driver:R}=r(g);return qt(R.getItem,S,_).then(D=>ha(D))},getItems(g,_){return y(g,_,S=>S.driver.getItems?qt(S.driver.getItems,S.items.map(R=>({key:R.relativeKey,options:R.options})),_).then(R=>R.map(D=>({key:pw(S.base,D.key),value:ha(D.value)}))):Promise.all(S.items.map(R=>qt(S.driver.getItem,R.relativeKey,R.options).then(D=>({key:R.key,value:ha(D)})))))},getItemRaw(g,_={}){g=nr(g);const{relativeKey:S,driver:R}=r(g);return R.getItemRaw?qt(R.getItemRaw,S,_):qt(R.getItem,S,_).then(D=>fw(D))},async setItem(g,_,S={}){if(_===void 0)return m.removeItem(g);g=nr(g);const{relativeKey:R,driver:D}=r(g);D.setItem&&(await qt(D.setItem,R,ma(_),S),D.watch||a("update",g))},async setItems(g,_){await y(g,_,async S=>{if(S.driver.setItems)return qt(S.driver.setItems,S.items.map(R=>({key:R.relativeKey,value:ma(R.value),options:R.options})),_);S.driver.setItem&&await Promise.all(S.items.map(R=>qt(S.driver.setItem,R.relativeKey,ma(R.value),R.options)))})},async setItemRaw(g,_,S={}){if(_===void 0)return m.removeItem(g,S);g=nr(g);const{relativeKey:R,driver:D}=r(g);if(D.setItemRaw)await qt(D.setItemRaw,R,_,S);else if(D.setItem)await qt(D.setItem,R,lw(_),S);else return;D.watch||a("update",g)},async removeItem(g,_={}){typeof _=="boolean"&&(_={removeMeta:_}),g=nr(g);const{relativeKey:S,driver:R}=r(g);R.removeItem&&(await qt(R.removeItem,S,_),(_.removeMeta||_.removeMata)&&await qt(R.removeItem,S+"$",_),R.watch||a("remove",g))},async getMeta(g,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),g=nr(g);const{relativeKey:S,driver:R}=r(g),D=Object.create(null);if(R.getMeta&&Object.assign(D,await qt(R.getMeta,S,_)),!_.nativeOnly){const C=await qt(R.getItem,S+"$",_).then(Z=>ha(Z));C&&typeof C=="object"&&(typeof C.atime=="string"&&(C.atime=new Date(C.atime)),typeof C.mtime=="string"&&(C.mtime=new Date(C.mtime)),Object.assign(D,C))}return D},setMeta(g,_,S={}){return this.setItem(g+"$",_,S)},removeMeta(g,_={}){return this.removeItem(g+"$",_)},async getKeys(g,_={}){g=la(g);const S=s(g,!0);let R=[];const D=[];for(const C of S){const se=(await qt(C.driver.getKeys,C.relativeBase,_)).map(ne=>C.mountpoint+nr(ne)).filter(ne=>!R.some(ce=>ne.startsWith(ce)));D.push(...se),R=[C.mountpoint,...R.filter(ne=>!ne.startsWith(C.mountpoint))]}return g?D.filter(C=>C.startsWith(g)&&!C.endsWith("$")):D.filter(C=>!C.endsWith("$"))},async clear(g,_={}){g=la(g),await Promise.all(s(g,!1).map(async S=>{if(S.driver.clear)return qt(S.driver.clear,S.relativeBase,_);if(S.driver.removeItem){const R=await S.driver.getKeys(S.relativeBase||"",_);return Promise.all(R.map(D=>S.driver.removeItem(D,_)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(g=>Xh(g)))},async watch(g){return await u(),t.watchListeners.push(g),async()=>{t.watchListeners=t.watchListeners.filter(_=>_!==g),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(g,_){if(g=la(g),g&&t.mounts[g])throw new Error(`already mounted at ${g}`);return g&&(t.mountpoints.push(g),t.mountpoints.sort((S,R)=>R.length-S.length)),t.mounts[g]=_,t.watching&&Promise.resolve(Zh(_,a,g)).then(S=>{t.unwatch[g]=S}).catch(console.error),m},async unmount(g,_=!0){g=la(g),!(!g||!t.mounts[g])&&(t.watching&&g in t.unwatch&&(t.unwatch[g](),delete t.unwatch[g]),_&&await Xh(t.mounts[g]),t.mountpoints=t.mountpoints.filter(S=>S!==g),delete t.mounts[g])},getMount(g=""){g=nr(g)+":";const _=r(g);return{driver:_.driver,base:_.base}},getMounts(g="",_={}){return g=nr(g),s(g,_.parents).map(R=>({driver:R.driver,base:R.mountpoint}))}};return m}function Zh(o,t,r){return o.watch?o.watch((s,a)=>t(s,r+a)):()=>{}}async function Xh(o){typeof o.dispose=="function"&&await qt(o.dispose)}function ki(o){return new Promise((t,r)=>{o.oncomplete=o.onsuccess=()=>t(o.result),o.onabort=o.onerror=()=>r(o.error)})}function rf(o,t){const r=indexedDB.open(o);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=ki(r);return(a,u)=>s.then(f=>u(f.transaction(t,a).objectStore(t)))}let nc;function en(){return nc||(nc=rf("keyval-store","keyval")),nc}function el(o,t=en()){return t("readonly",r=>ki(r.get(o)))}function vw(o,t,r=en()){return r("readwrite",s=>(s.put(t,o),ki(s.transaction)))}function mw(o,t=en()){return t("readwrite",r=>(r.delete(o),ki(r.transaction)))}function ww(o=en()){return o("readwrite",t=>(t.clear(),ki(t.transaction)))}function _w(o,t){return o.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},ki(o.transaction)}function bw(o=en()){return o("readonly",t=>{if(t.getAllKeys)return ki(t.getAllKeys());const r=[];return _w(t,s=>r.push(s.key)).then(()=>r)})}const Ew="idb-keyval";var Iw=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>t+a;let s;return o.dbName&&o.storeName&&(s=rf(o.dbName,o.storeName)),{name:Ew,options:o,async hasItem(a){return!(typeof await el(r(a),s)>"u")},async getItem(a){return await el(r(a),s)??null},setItem(a,u){return vw(r(a),u,s)},removeItem(a){return mw(r(a),s)},getKeys(){return bw(s)},clear(){return ww(s)}}};const xw="WALLET_CONNECT_V2_INDEXED_DB",Pw="keyvaluestorage";let Sw=class{constructor(){this.indexedDb=yw({driver:Iw({dbName:xw,storeName:Pw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Zs(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var ac=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ni<"u"?ni:typeof self<"u"?self:{},wa={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ac<"u"&&ac.localStorage?wa.exports=ac.localStorage:typeof window<"u"&&window.localStorage?wa.exports=window.localStorage:wa.exports=new t})();function Ow(o){var t;return[o[0],xa((t=o[1])!=null?t:"")]}class Rw{constructor(){this.localStorage=wa.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Ow)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return xa(r)}async setItem(t,r){this.localStorage.setItem(t,Zs(r))}async removeItem(t){this.localStorage.removeItem(t)}}const Aw="wc_storage_version",tl=1,Cw=async(o,t,r)=>{const s=Aw,a=await t.getItem(s);if(a&&a>=tl){r(t);return}const u=await o.getKeys();if(!u.length){r(t);return}const f=[];for(;u.length;){const y=u.shift();if(!y)continue;const m=y.toLowerCase();if(m.includes("wc@")||m.includes("walletconnect")||m.includes("wc_")||m.includes("wallet_connect")){const g=await o.getItem(y);await t.setItem(y,g),f.push(y)}}await t.setItem(s,tl),r(t),Tw(o,f)},Tw=async(o,t)=>{t.length&&t.forEach(async r=>{await o.removeItem(r)})};let $w=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Rw;this.storage=t;try{const r=new Sw;Cw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var ms={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ec=function(o,t){return Ec=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},Ec(o,t)};function Nw(o,t){Ec(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Ic=function(){return Ic=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},Ic.apply(this,arguments)};function Dw(o,t){var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(r[s[a]]=o[s[a]]);return r}function qw(o,t,r,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,t,r,s);else for(var y=o.length-1;y>=0;y--)(f=o[y])&&(u=(a<3?f(u):a>3?f(t,r,u):f(t,r))||u);return a>3&&u&&Object.defineProperty(t,r,u),u}function Lw(o,t){return function(r,s){t(r,s,o)}}function jw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function zw(o,t,r,s){function a(u){return u instanceof r?u:new r(function(f){f(u)})}return new(r||(r=Promise))(function(u,f){function y(_){try{g(s.next(_))}catch(S){f(S)}}function m(_){try{g(s.throw(_))}catch(S){f(S)}}function g(_){_.done?u(_.value):a(_.value).then(y,m)}g((s=s.apply(o,t||[])).next())})}function Mw(o,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,f;return f={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function y(g){return function(_){return m([g,_])}}function m(g){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=g[0]&2?a.return:g[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,g[1])).done)return u;switch(a=0,u&&(g=[g[0]&2,u.value]),g[0]){case 0:case 1:u=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,a=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(g[0]===6||g[0]===2)){r=0;continue}if(g[0]===3&&(!u||g[1]>u[0]&&g[1]<u[3])){r.label=g[1];break}if(g[0]===6&&r.label<u[1]){r.label=u[1],u=g;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(g);break}u[2]&&r.ops.pop(),r.trys.pop();continue}g=t.call(o,r)}catch(_){g=[6,_],a=0}finally{s=u=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function Uw(o,t,r,s){s===void 0&&(s=r),o[s]=t[r]}function Hw(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function xc(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],s=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function sf(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var s=r.call(o),a,u=[],f;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(y){f={error:y}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(f)throw f.error}}return u}function kw(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(sf(arguments[t]));return o}function Kw(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var s=Array(o),a=0,t=0;t<r;t++)for(var u=arguments[t],f=0,y=u.length;f<y;f++,a++)s[a]=u[f];return s}function Js(o){return this instanceof Js?(this.v=o,this):new Js(o)}function Vw(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(o,t||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(R){s[R]&&(a[R]=function(D){return new Promise(function(C,Z){u.push([R,D,C,Z])>1||y(R,D)})})}function y(R,D){try{m(s[R](D))}catch(C){S(u[0][3],C)}}function m(R){R.value instanceof Js?Promise.resolve(R.value.v).then(g,_):S(u[0][2],R)}function g(R){y("next",R)}function _(R){y("throw",R)}function S(R,D){R(D),u.shift(),u.length&&y(u[0][0],u[0][1])}}function Fw(o){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=o[a]?function(f){return(r=!r)?{value:Js(o[a](f)),done:a==="return"}:u?u(f):f}:u}}function Bw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof xc=="function"?xc(o):o[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=o[u]&&function(f){return new Promise(function(y,m){f=o[u](f),a(y,m,f.done,f.value)})}}function a(u,f,y,m){Promise.resolve(m).then(function(g){u({value:g,done:y})},f)}}function Gw(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function Ww(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function Jw(o){return o&&o.__esModule?o:{default:o}}function Qw(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function Yw(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const Zw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ic},__asyncDelegator:Fw,__asyncGenerator:Vw,__asyncValues:Bw,__await:Js,__awaiter:zw,__classPrivateFieldGet:Qw,__classPrivateFieldSet:Yw,__createBinding:Uw,__decorate:qw,__exportStar:Hw,__extends:Nw,__generator:Mw,__importDefault:Jw,__importStar:Ww,__makeTemplateObject:Gw,__metadata:jw,__param:Lw,__read:sf,__rest:Dw,__spread:kw,__spreadArrays:Kw,__values:xc},Symbol.toStringTag,{value:"Module"})),Sa=Nc(Zw);var zs={},oc={},Ms={};class Ki{}const Xw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ki},Symbol.toStringTag,{value:"Module"})),e_=Nc(Xw);var rl;function t_(){if(rl)return Ms;rl=1,Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.IHeartBeat=void 0;const o=e_;class t extends o.IEvents{constructor(s){super()}}return Ms.IHeartBeat=t,Ms}var il;function nf(){return il||(il=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Sa.__exportStar(t_(),o)}(oc)),oc}var cc={},Ui={},sl;function r_(){if(sl)return Ui;sl=1,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.HEARTBEAT_EVENTS=Ui.HEARTBEAT_INTERVAL=void 0;const o=X;return Ui.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Ui.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ui}var nl;function af(){return nl||(nl=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Sa.__exportStar(r_(),o)}(cc)),cc}var al;function i_(){if(al)return zs;al=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.HeartBeat=void 0;const o=Sa,t=Sr,r=X,s=nf(),a=af();class u extends s.IHeartBeat{constructor(y){super(y),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||a.HEARTBEAT_INTERVAL}static init(y){return o.__awaiter(this,void 0,void 0,function*(){const m=new u(y);return yield m.init(),m})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,m){this.events.on(y,m)}once(y,m){this.events.once(y,m)}off(y,m){this.events.off(y,m)}removeListener(y,m){this.events.removeListener(y,m)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return zs.HeartBeat=u,zs}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=Sa;t.__exportStar(i_(),o),t.__exportStar(nf(),o),t.__exportStar(af(),o)})(ms);function s_(o){try{return JSON.stringify(o)}catch{return'"[Circular]"'}}var n_=a_;function a_(o,t,r){var s=r&&r.stringify||s_,a=1;if(typeof o=="object"&&o!==null){var u=t.length+a;if(u===1)return o;var f=new Array(u);f[0]=s(o);for(var y=1;y<u;y++)f[y]=s(t[y]);return f.join(" ")}if(typeof o!="string")return o;var m=t.length;if(m===0)return o;for(var g="",_=1-a,S=-1,R=o&&o.length||0,D=0;D<R;){if(o.charCodeAt(D)===37&&D+1<R){switch(S=S>-1?S:0,o.charCodeAt(D+1)){case 100:case 102:if(_>=m||t[_]==null)break;S<D&&(g+=o.slice(S,D)),g+=Number(t[_]),S=D+2,D++;break;case 105:if(_>=m||t[_]==null)break;S<D&&(g+=o.slice(S,D)),g+=Math.floor(Number(t[_])),S=D+2,D++;break;case 79:case 111:case 106:if(_>=m||t[_]===void 0)break;S<D&&(g+=o.slice(S,D));var C=typeof t[_];if(C==="string"){g+="'"+t[_]+"'",S=D+2,D++;break}if(C==="function"){g+=t[_].name||"<anonymous>",S=D+2,D++;break}g+=s(t[_]),S=D+2,D++;break;case 115:if(_>=m)break;S<D&&(g+=o.slice(S,D)),g+=String(t[_]),S=D+2,D++;break;case 37:S<D&&(g+=o.slice(S,D)),g+="%",S=D+2,D++,_--;break}++_}++D}return S===-1?o:(S<R&&(g+=o.slice(S)),g)}const ol=n_;var o_=Vr;const Qs=v_().console||{},c_={mapHttpRequest:fa,mapHttpResponse:fa,wrapRequestSerializer:uc,wrapResponseSerializer:uc,wrapErrorSerializer:uc,req:fa,res:fa,err:p_};function u_(o,t){return Array.isArray(o)?o.filter(function(s){return s!=="!stdSerializers.err"}):o===!0?Object.keys(t):!1}function Vr(o){o=o||{},o.browser=o.browser||{};const t=o.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=o.browser.write||Qs;o.browser.write&&(o.browser.asObject=!0);const s=o.serializers||{},a=u_(o.browser.serialize,s);let u=o.browser.serialize;Array.isArray(o.browser.serialize)&&o.browser.serialize.indexOf("!stdSerializers.err")>-1&&(u=!1);const f=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),o.enabled===!1&&(o.level="silent");const y=o.level||"info",m=Object.create(r);m.log||(m.log=Ys),Object.defineProperty(m,"levelVal",{get:_}),Object.defineProperty(m,"level",{get:S,set:R});const g={transmit:t,serialize:a,asObject:o.browser.asObject,levels:f,timestamp:d_(o)};m.levels=Vr.levels,m.level=y,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=Ys,m.serializers=s,m._serialize=a,m._stdErrSerialize=u,m.child=D,t&&(m._logEvent=Pc());function _(){return this.level==="silent"?1/0:this.levels.values[this.level]}function S(){return this._level}function R(C){if(C!=="silent"&&!this.levels.values[C])throw Error("unknown level "+C);this._level=C,ls(g,m,"error","log"),ls(g,m,"fatal","error"),ls(g,m,"warn","error"),ls(g,m,"info","log"),ls(g,m,"debug","log"),ls(g,m,"trace","log")}function D(C,Z){if(!C)throw new Error("missing bindings for child Pino");Z=Z||{},a&&C.serializers&&(Z.serializers=C.serializers);const se=Z.serializers;if(a&&se){var ne=Object.assign({},s,se),ce=o.browser.serialize===!0?Object.keys(ne):a;delete C.serializers,Oa([C],ce,ne,this._stdErrSerialize)}function ae(te){this._childLevel=(te._childLevel|0)+1,this.error=fs(te,C,"error"),this.fatal=fs(te,C,"fatal"),this.warn=fs(te,C,"warn"),this.info=fs(te,C,"info"),this.debug=fs(te,C,"debug"),this.trace=fs(te,C,"trace"),ne&&(this.serializers=ne,this._serialize=ce),t&&(this._logEvent=Pc([].concat(te._logEvent.bindings,C)))}return ae.prototype=this,new ae(this)}return m}Vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Vr.stdSerializers=c_;Vr.stdTimeFunctions=Object.assign({},{nullTime:of,epochTime:cf,unixTime:g_,isoTime:y_});function ls(o,t,r,s){const a=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?Ys:a[r]?a[r]:Qs[r]||Qs[s]||Ys,h_(o,t,r)}function h_(o,t,r){!o.transmit&&t[r]===Ys||(t[r]=function(s){return function(){const u=o.timestamp(),f=new Array(arguments.length),y=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Qs?Qs:this;for(var m=0;m<f.length;m++)f[m]=arguments[m];if(o.serialize&&!o.asObject&&Oa(f,this._serialize,this.serializers,this._stdErrSerialize),o.asObject?s.call(y,l_(this,r,f,u)):s.apply(y,f),o.transmit){const g=o.transmit.level||t.level,_=Vr.levels.values[g],S=Vr.levels.values[r];if(S<_)return;f_(this,{ts:u,methodLevel:r,methodValue:S,transmitLevel:g,transmitValue:Vr.levels.values[o.transmit.level||t.level],send:o.transmit.send,val:t.levelVal},f)}}}(t[r]))}function l_(o,t,r,s){o._serialize&&Oa(r,o._serialize,o.serializers,o._stdErrSerialize);const a=r.slice();let u=a[0];const f={};s&&(f.time=s),f.level=Vr.levels.values[t];let y=(o._childLevel|0)+1;if(y<1&&(y=1),u!==null&&typeof u=="object"){for(;y--&&typeof a[0]=="object";)Object.assign(f,a.shift());u=a.length?ol(a.shift(),a):void 0}else typeof u=="string"&&(u=ol(a.shift(),a));return u!==void 0&&(f.msg=u),f}function Oa(o,t,r,s){for(const a in o)if(s&&o[a]instanceof Error)o[a]=Vr.stdSerializers.err(o[a]);else if(typeof o[a]=="object"&&!Array.isArray(o[a]))for(const u in o[a])t&&t.indexOf(u)>-1&&u in r&&(o[a][u]=r[u](o[a][u]))}function fs(o,t,r){return function(){const s=new Array(1+arguments.length);s[0]=t;for(var a=1;a<s.length;a++)s[a]=arguments[a-1];return o[r].apply(this,s)}}function f_(o,t,r){const s=t.send,a=t.ts,u=t.methodLevel,f=t.methodValue,y=t.val,m=o._logEvent.bindings;Oa(r,o._serialize||Object.keys(o.serializers),o.serializers,o._stdErrSerialize===void 0?!0:o._stdErrSerialize),o._logEvent.ts=a,o._logEvent.messages=r.filter(function(g){return m.indexOf(g)===-1}),o._logEvent.level.label=u,o._logEvent.level.value=f,s(u,o._logEvent,y),o._logEvent=Pc(m)}function Pc(o){return{ts:0,messages:[],bindings:o||[],level:{label:"",value:0}}}function p_(o){const t={type:o.constructor.name,msg:o.message,stack:o.stack};for(const r in o)t[r]===void 0&&(t[r]=o[r]);return t}function d_(o){return typeof o.timestamp=="function"?o.timestamp:o.timestamp===!1?of:cf}function fa(){return{}}function uc(o){return o}function Ys(){}function of(){return!1}function cf(){return Date.now()}function g_(){return Math.round(Date.now()/1e3)}function y_(){return new Date(Date.now()).toISOString()}function v_(){function o(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return o(self)||o(window)||o(this)||{}}}const Ra=Dc(o_),m_={level:"info"},tn="custom_context";var w_=Object.defineProperty,__=Object.defineProperties,b_=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,E_=Object.prototype.hasOwnProperty,I_=Object.prototype.propertyIsEnumerable,ul=(o,t,r)=>t in o?w_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,x_=(o,t)=>{for(var r in t||(t={}))E_.call(t,r)&&ul(o,r,t[r]);if(cl)for(var r of cl(t))I_.call(t,r)&&ul(o,r,t[r]);return o},P_=(o,t)=>__(o,b_(t));function Aa(o){return P_(x_({},o),{level:(o==null?void 0:o.level)||m_.level})}function S_(o,t=tn){return o[t]||""}function O_(o,t,r=tn){return o[r]=t,o}function or(o,t=tn){let r="";return typeof o.bindings>"u"?r=S_(o,t):r=o.bindings().context||"",r}function R_(o,t,r=tn){const s=or(o,r);return s.trim()?`${s}/${t}`:t}function cr(o,t,r=tn){const s=R_(o,t,r),a=o.child({context:s});return O_(a,s,r)}class A_ extends Ki{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let C_=class extends Ki{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},T_=class{constructor(t,r){this.logger=t,this.core=r}},$_=class extends Ki{constructor(t,r){super(),this.relayer=t,this.logger=r}},N_=class extends Ki{constructor(t){super()}},D_=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class q_ extends Ki{constructor(t,r){super(),this.relayer=t,this.logger=r}}let L_=class extends Ki{constructor(t,r){super(),this.core=t,this.logger=r}},j_=class{constructor(t,r){this.projectId=t,this.logger=r}},z_=class{constructor(t,r){this.projectId=t,this.logger=r}},M_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},U_=class{constructor(t){this.client=t}};var Uc={},uf={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var t=l0,r=Bl;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var s=function(){function y(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(m,g){if(g===void 0&&(g=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&g>0;)this._buffer[this._bufferLength++]=m[_++],g--;this._bufferLength===this.blockSize&&(u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(_=u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,_,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=m[_++],g--;return this},y.prototype.finish=function(m){if(!this._finished){var g=this._bytesHashed,_=this._bufferLength,S=g/536870912|0,R=g<<3,D=g%128<112?128:256;this._buffer[_]=128;for(var C=_+1;C<D-8;C++)this._buffer[C]=0;t.writeUint32BE(S,this._buffer,D-8),t.writeUint32BE(R,this._buffer,D-4),u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,D),this._finished=!0}for(var C=0;C<this.digestLength/8;C++)t.writeUint32BE(this._stateHi[C],m,C*8),t.writeUint32BE(this._stateLo[C],m,C*8+4);return this},y.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(m){r.wipe(m.stateHi),r.wipe(m.stateLo),m.buffer&&r.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},y}();o.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function u(y,m,g,_,S,R,D){for(var C=g[0],Z=g[1],se=g[2],ne=g[3],ce=g[4],ae=g[5],te=g[6],fe=g[7],pe=_[0],Q=_[1],xe=_[2],Tt=_[3],yt=_[4],Yt=_[5],Vt=_[6],ur=_[7],M,U,Ge,qe,G,K,H,V;D>=128;){for(var Ot=0;Ot<16;Ot++){var rt=8*Ot+R;y[Ot]=t.readUint32BE(S,rt),m[Ot]=t.readUint32BE(S,rt+4)}for(var Ot=0;Ot<80;Ot++){var Pi=C,we=Z,Or=se,$=ne,T=ce,O=ae,h=te,E=fe,J=pe,oe=Q,ge=xe,Pe=Tt,Oe=yt,_e=Yt,vt=Vt,lt=ur;if(M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(ce>>>14|yt<<18)^(ce>>>18|yt<<14)^(yt>>>9|ce<<23),U=(yt>>>14|ce<<18)^(yt>>>18|ce<<14)^(ce>>>9|yt<<23),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=ce&ae^~ce&te,U=yt&Yt^~yt&Vt,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=a[Ot*2],U=a[Ot*2+1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=y[Ot%16],U=m[Ot%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,Ge=H&65535|V<<16,qe=G&65535|K<<16,M=Ge,U=qe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(C>>>28|pe<<4)^(pe>>>2|C<<30)^(pe>>>7|C<<25),U=(pe>>>28|C<<4)^(C>>>2|pe<<30)^(C>>>7|pe<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=C&Z^C&se^Z&se,U=pe&Q^pe&xe^Q&xe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,E=H&65535|V<<16,lt=G&65535|K<<16,M=$,U=Pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=Ge,U=qe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,$=H&65535|V<<16,Pe=G&65535|K<<16,Z=Pi,se=we,ne=Or,ce=$,ae=T,te=O,fe=h,C=E,Q=J,xe=oe,Tt=ge,yt=Pe,Yt=Oe,Vt=_e,ur=vt,pe=lt,Ot%16===15)for(var rt=0;rt<16;rt++)M=y[rt],U=m[rt],G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=y[(rt+9)%16],U=m[(rt+9)%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+1)%16],qe=m[(rt+1)%16],M=(Ge>>>1|qe<<31)^(Ge>>>8|qe<<24)^Ge>>>7,U=(qe>>>1|Ge<<31)^(qe>>>8|Ge<<24)^(qe>>>7|Ge<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+14)%16],qe=m[(rt+14)%16],M=(Ge>>>19|qe<<13)^(qe>>>29|Ge<<3)^Ge>>>6,U=(qe>>>19|Ge<<13)^(Ge>>>29|qe<<3)^(qe>>>6|Ge<<26),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,y[rt]=H&65535|V<<16,m[rt]=G&65535|K<<16}M=C,U=pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[0],U=_[0],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[0]=C=H&65535|V<<16,_[0]=pe=G&65535|K<<16,M=Z,U=Q,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[1],U=_[1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[1]=Z=H&65535|V<<16,_[1]=Q=G&65535|K<<16,M=se,U=xe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[2],U=_[2],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[2]=se=H&65535|V<<16,_[2]=xe=G&65535|K<<16,M=ne,U=Tt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[3],U=_[3],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[3]=ne=H&65535|V<<16,_[3]=Tt=G&65535|K<<16,M=ce,U=yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[4],U=_[4],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[4]=ce=H&65535|V<<16,_[4]=yt=G&65535|K<<16,M=ae,U=Yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[5],U=_[5],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[5]=ae=H&65535|V<<16,_[5]=Yt=G&65535|K<<16,M=te,U=Vt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[6],U=_[6],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[6]=te=H&65535|V<<16,_[6]=Vt=G&65535|K<<16,M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=g[7],U=_[7],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,g[7]=fe=H&65535|V<<16,_[7]=ur=G&65535|K<<16,R+=128,D-=128}return R}function f(y){var m=new s;m.update(y);var g=m.digest();return m.clean(),g}o.hash=f})(uf);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const t=Gl,r=uf,s=Bl;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a($){const T=new Float64Array(16);if($)for(let O=0;O<$.length;O++)T[O]=$[O];return T}const u=new Uint8Array(32);u[0]=9;const f=a(),y=a([1]),m=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),R=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function D($,T){for(let O=0;O<16;O++)$[O]=T[O]|0}function C($){let T=1;for(let O=0;O<16;O++){let h=$[O]+T+65535;T=Math.floor(h/65536),$[O]=h-T*65536}$[0]+=T-1+37*(T-1)}function Z($,T,O){const h=~(O-1);for(let E=0;E<16;E++){const J=h&($[E]^T[E]);$[E]^=J,T[E]^=J}}function se($,T){const O=a(),h=a();for(let E=0;E<16;E++)h[E]=T[E];C(h),C(h),C(h);for(let E=0;E<2;E++){O[0]=h[0]-65517;for(let oe=1;oe<15;oe++)O[oe]=h[oe]-65535-(O[oe-1]>>16&1),O[oe-1]&=65535;O[15]=h[15]-32767-(O[14]>>16&1);const J=O[15]>>16&1;O[14]&=65535,Z(h,O,1-J)}for(let E=0;E<16;E++)$[2*E]=h[E]&255,$[2*E+1]=h[E]>>8}function ne($,T){let O=0;for(let h=0;h<32;h++)O|=$[h]^T[h];return(1&O-1>>>8)-1}function ce($,T){const O=new Uint8Array(32),h=new Uint8Array(32);return se(O,$),se(h,T),ne(O,h)}function ae($){const T=new Uint8Array(32);return se(T,$),T[0]&1}function te($,T){for(let O=0;O<16;O++)$[O]=T[2*O]+(T[2*O+1]<<8);$[15]&=32767}function fe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]+O[h]}function pe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]-O[h]}function Q($,T,O){let h,E,J=0,oe=0,ge=0,Pe=0,Oe=0,_e=0,vt=0,lt=0,Ze=0,Ae=0,ke=0,Ke=0,Xe=0,Ne=0,Ve=0,Se=0,Le=0,it=0,Te=0,mt=0,Rt=0,Lt=0,jt=0,$t=0,Ft=0,Zt=0,jr=0,Bt=0,Fr=0,oi=0,Si=0,st=O[0],We=O[1],nt=O[2],at=O[3],et=O[4],Je=O[5],wt=O[6],_t=O[7],ot=O[8],bt=O[9],ct=O[10],ft=O[11],ut=O[12],He=O[13],Et=O[14],It=O[15];h=T[0],J+=h*st,oe+=h*We,ge+=h*nt,Pe+=h*at,Oe+=h*et,_e+=h*Je,vt+=h*wt,lt+=h*_t,Ze+=h*ot,Ae+=h*bt,ke+=h*ct,Ke+=h*ft,Xe+=h*ut,Ne+=h*He,Ve+=h*Et,Se+=h*It,h=T[1],oe+=h*st,ge+=h*We,Pe+=h*nt,Oe+=h*at,_e+=h*et,vt+=h*Je,lt+=h*wt,Ze+=h*_t,Ae+=h*ot,ke+=h*bt,Ke+=h*ct,Xe+=h*ft,Ne+=h*ut,Ve+=h*He,Se+=h*Et,Le+=h*It,h=T[2],ge+=h*st,Pe+=h*We,Oe+=h*nt,_e+=h*at,vt+=h*et,lt+=h*Je,Ze+=h*wt,Ae+=h*_t,ke+=h*ot,Ke+=h*bt,Xe+=h*ct,Ne+=h*ft,Ve+=h*ut,Se+=h*He,Le+=h*Et,it+=h*It,h=T[3],Pe+=h*st,Oe+=h*We,_e+=h*nt,vt+=h*at,lt+=h*et,Ze+=h*Je,Ae+=h*wt,ke+=h*_t,Ke+=h*ot,Xe+=h*bt,Ne+=h*ct,Ve+=h*ft,Se+=h*ut,Le+=h*He,it+=h*Et,Te+=h*It,h=T[4],Oe+=h*st,_e+=h*We,vt+=h*nt,lt+=h*at,Ze+=h*et,Ae+=h*Je,ke+=h*wt,Ke+=h*_t,Xe+=h*ot,Ne+=h*bt,Ve+=h*ct,Se+=h*ft,Le+=h*ut,it+=h*He,Te+=h*Et,mt+=h*It,h=T[5],_e+=h*st,vt+=h*We,lt+=h*nt,Ze+=h*at,Ae+=h*et,ke+=h*Je,Ke+=h*wt,Xe+=h*_t,Ne+=h*ot,Ve+=h*bt,Se+=h*ct,Le+=h*ft,it+=h*ut,Te+=h*He,mt+=h*Et,Rt+=h*It,h=T[6],vt+=h*st,lt+=h*We,Ze+=h*nt,Ae+=h*at,ke+=h*et,Ke+=h*Je,Xe+=h*wt,Ne+=h*_t,Ve+=h*ot,Se+=h*bt,Le+=h*ct,it+=h*ft,Te+=h*ut,mt+=h*He,Rt+=h*Et,Lt+=h*It,h=T[7],lt+=h*st,Ze+=h*We,Ae+=h*nt,ke+=h*at,Ke+=h*et,Xe+=h*Je,Ne+=h*wt,Ve+=h*_t,Se+=h*ot,Le+=h*bt,it+=h*ct,Te+=h*ft,mt+=h*ut,Rt+=h*He,Lt+=h*Et,jt+=h*It,h=T[8],Ze+=h*st,Ae+=h*We,ke+=h*nt,Ke+=h*at,Xe+=h*et,Ne+=h*Je,Ve+=h*wt,Se+=h*_t,Le+=h*ot,it+=h*bt,Te+=h*ct,mt+=h*ft,Rt+=h*ut,Lt+=h*He,jt+=h*Et,$t+=h*It,h=T[9],Ae+=h*st,ke+=h*We,Ke+=h*nt,Xe+=h*at,Ne+=h*et,Ve+=h*Je,Se+=h*wt,Le+=h*_t,it+=h*ot,Te+=h*bt,mt+=h*ct,Rt+=h*ft,Lt+=h*ut,jt+=h*He,$t+=h*Et,Ft+=h*It,h=T[10],ke+=h*st,Ke+=h*We,Xe+=h*nt,Ne+=h*at,Ve+=h*et,Se+=h*Je,Le+=h*wt,it+=h*_t,Te+=h*ot,mt+=h*bt,Rt+=h*ct,Lt+=h*ft,jt+=h*ut,$t+=h*He,Ft+=h*Et,Zt+=h*It,h=T[11],Ke+=h*st,Xe+=h*We,Ne+=h*nt,Ve+=h*at,Se+=h*et,Le+=h*Je,it+=h*wt,Te+=h*_t,mt+=h*ot,Rt+=h*bt,Lt+=h*ct,jt+=h*ft,$t+=h*ut,Ft+=h*He,Zt+=h*Et,jr+=h*It,h=T[12],Xe+=h*st,Ne+=h*We,Ve+=h*nt,Se+=h*at,Le+=h*et,it+=h*Je,Te+=h*wt,mt+=h*_t,Rt+=h*ot,Lt+=h*bt,jt+=h*ct,$t+=h*ft,Ft+=h*ut,Zt+=h*He,jr+=h*Et,Bt+=h*It,h=T[13],Ne+=h*st,Ve+=h*We,Se+=h*nt,Le+=h*at,it+=h*et,Te+=h*Je,mt+=h*wt,Rt+=h*_t,Lt+=h*ot,jt+=h*bt,$t+=h*ct,Ft+=h*ft,Zt+=h*ut,jr+=h*He,Bt+=h*Et,Fr+=h*It,h=T[14],Ve+=h*st,Se+=h*We,Le+=h*nt,it+=h*at,Te+=h*et,mt+=h*Je,Rt+=h*wt,Lt+=h*_t,jt+=h*ot,$t+=h*bt,Ft+=h*ct,Zt+=h*ft,jr+=h*ut,Bt+=h*He,Fr+=h*Et,oi+=h*It,h=T[15],Se+=h*st,Le+=h*We,it+=h*nt,Te+=h*at,mt+=h*et,Rt+=h*Je,Lt+=h*wt,jt+=h*_t,$t+=h*ot,Ft+=h*bt,Zt+=h*ct,jr+=h*ft,Bt+=h*ut,Fr+=h*He,oi+=h*Et,Si+=h*It,J+=38*Le,oe+=38*it,ge+=38*Te,Pe+=38*mt,Oe+=38*Rt,_e+=38*Lt,vt+=38*jt,lt+=38*$t,Ze+=38*Ft,Ae+=38*Zt,ke+=38*jr,Ke+=38*Bt,Xe+=38*Fr,Ne+=38*oi,Ve+=38*Si,E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=oe+E+65535,E=Math.floor(h/65536),oe=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,h=_e+E+65535,E=Math.floor(h/65536),_e=h-E*65536,h=vt+E+65535,E=Math.floor(h/65536),vt=h-E*65536,h=lt+E+65535,E=Math.floor(h/65536),lt=h-E*65536,h=Ze+E+65535,E=Math.floor(h/65536),Ze=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=ke+E+65535,E=Math.floor(h/65536),ke=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Xe+E+65535,E=Math.floor(h/65536),Xe=h-E*65536,h=Ne+E+65535,E=Math.floor(h/65536),Ne=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,J+=E-1+37*(E-1),E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=oe+E+65535,E=Math.floor(h/65536),oe=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,h=_e+E+65535,E=Math.floor(h/65536),_e=h-E*65536,h=vt+E+65535,E=Math.floor(h/65536),vt=h-E*65536,h=lt+E+65535,E=Math.floor(h/65536),lt=h-E*65536,h=Ze+E+65535,E=Math.floor(h/65536),Ze=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=ke+E+65535,E=Math.floor(h/65536),ke=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Xe+E+65535,E=Math.floor(h/65536),Xe=h-E*65536,h=Ne+E+65535,E=Math.floor(h/65536),Ne=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,J+=E-1+37*(E-1),$[0]=J,$[1]=oe,$[2]=ge,$[3]=Pe,$[4]=Oe,$[5]=_e,$[6]=vt,$[7]=lt,$[8]=Ze,$[9]=Ae,$[10]=ke,$[11]=Ke,$[12]=Xe,$[13]=Ne,$[14]=Ve,$[15]=Se}function xe($,T){Q($,T,T)}function Tt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=253;h>=0;h--)xe(O,O),h!==2&&h!==4&&Q(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function yt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=250;h>=0;h--)xe(O,O),h!==1&&Q(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function Yt($,T){const O=a(),h=a(),E=a(),J=a(),oe=a(),ge=a(),Pe=a(),Oe=a(),_e=a();pe(O,$[1],$[0]),pe(_e,T[1],T[0]),Q(O,O,_e),fe(h,$[0],$[1]),fe(_e,T[0],T[1]),Q(h,h,_e),Q(E,$[3],T[3]),Q(E,E,g),Q(J,$[2],T[2]),fe(J,J,J),pe(oe,h,O),pe(ge,J,E),fe(Pe,J,E),fe(Oe,h,O),Q($[0],oe,ge),Q($[1],Oe,Pe),Q($[2],Pe,ge),Q($[3],oe,Oe)}function Vt($,T,O){for(let h=0;h<4;h++)Z($[h],T[h],O)}function ur($,T){const O=a(),h=a(),E=a();Tt(E,T[2]),Q(O,T[0],E),Q(h,T[1],E),se($,h),$[31]^=ae(O)<<7}function M($,T,O){D($[0],f),D($[1],y),D($[2],y),D($[3],f);for(let h=255;h>=0;--h){const E=O[h/8|0]>>(h&7)&1;Vt($,T,E),Yt(T,$),Yt($,$),Vt($,T,E)}}function U($,T){const O=[a(),a(),a(),a()];D(O[0],_),D(O[1],S),D(O[2],y),Q(O[3],_,S),M($,O,T)}function Ge($){if($.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const T=(0,r.hash)($);T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(32),h=[a(),a(),a(),a()];U(h,T),ur(O,h);const E=new Uint8Array(64);return E.set($),E.set(O,32),{publicKey:O,secretKey:E}}o.generateKeyPairFromSeed=Ge;function qe($){const T=(0,t.randomBytes)(32,$),O=Ge(T);return(0,s.wipe)(T),O}o.generateKeyPair=qe;function G($){if($.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array($.subarray(32))}o.extractPublicKeyFromSecretKey=G;const K=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function H($,T){let O,h,E,J;for(h=63;h>=32;--h){for(O=0,E=h-32,J=h-12;E<J;++E)T[E]+=O-16*T[h]*K[E-(h-32)],O=Math.floor((T[E]+128)/256),T[E]-=O*256;T[E]+=O,T[h]=0}for(O=0,E=0;E<32;E++)T[E]+=O-(T[31]>>4)*K[E],O=T[E]>>8,T[E]&=255;for(E=0;E<32;E++)T[E]-=O*K[E];for(h=0;h<32;h++)T[h+1]+=T[h]>>8,$[h]=T[h]&255}function V($){const T=new Float64Array(64);for(let O=0;O<64;O++)T[O]=$[O];for(let O=0;O<64;O++)$[O]=0;H($,T)}function Ot($,T){const O=new Float64Array(64),h=[a(),a(),a(),a()],E=(0,r.hash)($.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const J=new Uint8Array(64);J.set(E.subarray(32),32);const oe=new r.SHA512;oe.update(J.subarray(32)),oe.update(T);const ge=oe.digest();oe.clean(),V(ge),U(h,ge),ur(J,h),oe.reset(),oe.update(J.subarray(0,32)),oe.update($.subarray(32)),oe.update(T);const Pe=oe.digest();V(Pe);for(let Oe=0;Oe<32;Oe++)O[Oe]=ge[Oe];for(let Oe=0;Oe<32;Oe++)for(let _e=0;_e<32;_e++)O[Oe+_e]+=Pe[Oe]*E[_e];return H(J.subarray(32),O),J}o.sign=Ot;function rt($,T){const O=a(),h=a(),E=a(),J=a(),oe=a(),ge=a(),Pe=a();return D($[2],y),te($[1],T),xe(E,$[1]),Q(J,E,m),pe(E,E,$[2]),fe(J,$[2],J),xe(oe,J),xe(ge,oe),Q(Pe,ge,oe),Q(O,Pe,E),Q(O,O,J),yt(O,O),Q(O,O,E),Q(O,O,J),Q(O,O,J),Q($[0],O,J),xe(h,$[0]),Q(h,h,J),ce(h,E)&&Q($[0],$[0],R),xe(h,$[0]),Q(h,h,J),ce(h,E)?-1:(ae($[0])===T[31]>>7&&pe($[0],f,$[0]),Q($[3],$[0],$[1]),0)}function Pi($,T,O){const h=new Uint8Array(32),E=[a(),a(),a(),a()],J=[a(),a(),a(),a()];if(O.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(rt(J,$))return!1;const oe=new r.SHA512;oe.update(O.subarray(0,32)),oe.update($),oe.update(T);const ge=oe.digest();return V(ge),M(E,J,ge),U(J,O.subarray(32)),Yt(E,J),ur(h,E),!ne(O,h)}o.verify=Pi;function we($){let T=[a(),a(),a(),a()];if(rt(T,$))throw new Error("Ed25519: invalid public key");let O=a(),h=a(),E=T[1];fe(O,y,E),pe(h,y,E),Tt(h,h),Q(O,O,h);let J=new Uint8Array(32);return se(J,O),J}o.convertPublicKeyToX25519=we;function Or($){const T=(0,r.hash)($.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(T.subarray(0,32));return(0,s.wipe)(T),O}o.convertSecretKeyToX25519=Or})(Uc);const H_="EdDSA",k_="JWT",hf=".",lf="base64url",K_="utf8",V_="utf8",F_=":",B_="did",G_="key",hl="base58btc",W_="z",J_="K36",Q_=32;function _a(o){return Ia(qc(Zs(o),K_),lf)}function ff(o){const t=qc(J_,hl),r=W_+Ia(f0([t,o]),hl);return[B_,G_,r].join(F_)}function Y_(o){return Ia(o,lf)}function Z_(o){return qc([_a(o.header),_a(o.payload)].join(hf),V_)}function X_(o){return[_a(o.header),_a(o.payload),Y_(o.signature)].join(hf)}function ll(o=Gl.randomBytes(Q_)){return Uc.generateKeyPairFromSeed(o)}async function e1(o,t,r,s,a=X.fromMiliseconds(Date.now())){const u={alg:H_,typ:k_},f=ff(s.publicKey),y=a+r,m={iss:f,sub:o,aud:t,iat:a,exp:y},g=Z_({header:u,payload:m}),_=Uc.sign(s.secretKey,g);return X_({header:u,payload:m,signature:_})}let t1=class extends ef{constructor(t){super(t),this.events=new Sr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Hi(t.method,t.params||[],t.id||jc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{Lr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Xs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const r1=()=>typeof WebSocket<"u"?WebSocket:typeof ni<"u"&&typeof ni.WebSocket<"u"?ni.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),i1=()=>typeof WebSocket<"u"||typeof ni<"u"&&typeof ni.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",fl=o=>o.split("?")[0],pl=10,s1=r1();let n1=class{constructor(t){if(this.url=t,this.events=new Sr.EventEmitter,this.registering=!1,!Yh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Zs(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Yh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=new URLSearchParams(t).get("origin"),u=X0.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!ew(t)},f=new s1(t,[],u);i1()?f.onerror=y=>{const m=y;s(this.emitError(m.error))}:f.on("error",y=>{s(this.emitError(y))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?xa(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=zc(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return tw(t,fl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>pl&&this.events.setMaxListeners(pl)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${fl(this.url)}`));return this.events.emit("register_error",r),r}};var ba={exports:{}};ba.exports;(function(o,t){var r=200,s="__lodash_hash_undefined__",a=1,u=2,f=9007199254740991,y="[object Arguments]",m="[object Array]",g="[object AsyncFunction]",_="[object Boolean]",S="[object Date]",R="[object Error]",D="[object Function]",C="[object GeneratorFunction]",Z="[object Map]",se="[object Number]",ne="[object Null]",ce="[object Object]",ae="[object Promise]",te="[object Proxy]",fe="[object RegExp]",pe="[object Set]",Q="[object String]",xe="[object Symbol]",Tt="[object Undefined]",yt="[object WeakMap]",Yt="[object ArrayBuffer]",Vt="[object DataView]",ur="[object Float32Array]",M="[object Float64Array]",U="[object Int8Array]",Ge="[object Int16Array]",qe="[object Int32Array]",G="[object Uint8Array]",K="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",Ot=/[\\^$.*+?()[\]{}|]/g,rt=/^\[object .+?Constructor\]$/,Pi=/^(?:0|[1-9]\d*)$/,we={};we[ur]=we[M]=we[U]=we[Ge]=we[qe]=we[G]=we[K]=we[H]=we[V]=!0,we[y]=we[m]=we[Yt]=we[_]=we[Vt]=we[S]=we[R]=we[D]=we[Z]=we[se]=we[ce]=we[fe]=we[pe]=we[Q]=we[yt]=!1;var Or=typeof ca=="object"&&ca&&ca.Object===Object&&ca,$=typeof self=="object"&&self&&self.Object===Object&&self,T=Or||$||Function("return this")(),O=t&&!t.nodeType&&t,h=O&&!0&&o&&!o.nodeType&&o,E=h&&h.exports===O,J=E&&Or.process,oe=function(){try{return J&&J.binding&&J.binding("util")}catch{}}(),ge=oe&&oe.isTypedArray;function Pe(v,I){for(var j=-1,F=v==null?0:v.length,ze=0,he=[];++j<F;){var Fe=v[j];I(Fe,j,v)&&(he[ze++]=Fe)}return he}function Oe(v,I){for(var j=-1,F=I.length,ze=v.length;++j<F;)v[ze+j]=I[j];return v}function _e(v,I){for(var j=-1,F=v==null?0:v.length;++j<F;)if(I(v[j],j,v))return!0;return!1}function vt(v,I){for(var j=-1,F=Array(v);++j<v;)F[j]=I(j);return F}function lt(v){return function(I){return v(I)}}function Ze(v,I){return v.has(I)}function Ae(v,I){return v==null?void 0:v[I]}function ke(v){var I=-1,j=Array(v.size);return v.forEach(function(F,ze){j[++I]=[ze,F]}),j}function Ke(v,I){return function(j){return v(I(j))}}function Xe(v){var I=-1,j=Array(v.size);return v.forEach(function(F){j[++I]=F}),j}var Ne=Array.prototype,Ve=Function.prototype,Se=Object.prototype,Le=T["__core-js_shared__"],it=Ve.toString,Te=Se.hasOwnProperty,mt=function(){var v=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Rt=Se.toString,Lt=RegExp("^"+it.call(Te).replace(Ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jt=E?T.Buffer:void 0,$t=T.Symbol,Ft=T.Uint8Array,Zt=Se.propertyIsEnumerable,jr=Ne.splice,Bt=$t?$t.toStringTag:void 0,Fr=Object.getOwnPropertySymbols,oi=jt?jt.isBuffer:void 0,Si=Ke(Object.keys,Object),st=hr(T,"DataView"),We=hr(T,"Map"),nt=hr(T,"Promise"),at=hr(T,"Set"),et=hr(T,"WeakMap"),Je=hr(Object,"create"),wt=Gr(st),_t=Gr(We),ot=Gr(nt),bt=Gr(at),ct=Gr(et),ft=$t?$t.prototype:void 0,ut=ft?ft.valueOf:void 0;function He(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Et(){this.__data__=Je?Je(null):{},this.size=0}function It(v){var I=this.has(v)&&delete this.__data__[v];return this.size-=I?1:0,I}function $a(v){var I=this.__data__;if(Je){var j=I[v];return j===s?void 0:j}return Te.call(I,v)?I[v]:void 0}function Na(v){var I=this.__data__;return Je?I[v]!==void 0:Te.call(I,v)}function Da(v,I){var j=this.__data__;return this.size+=this.has(v)?0:1,j[v]=Je&&I===void 0?s:I,this}He.prototype.clear=Et,He.prototype.delete=It,He.prototype.get=$a,He.prototype.has=Na,He.prototype.set=Da;function yr(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function qa(){this.__data__=[],this.size=0}function La(v){var I=this.__data__,j=Oi(I,v);if(j<0)return!1;var F=I.length-1;return j==F?I.pop():jr.call(I,j,1),--this.size,!0}function ja(v){var I=this.__data__,j=Oi(I,v);return j<0?void 0:I[j][1]}function za(v){return Oi(this.__data__,v)>-1}function Ma(v,I){var j=this.__data__,F=Oi(j,v);return F<0?(++this.size,j.push([v,I])):j[F][1]=I,this}yr.prototype.clear=qa,yr.prototype.delete=La,yr.prototype.get=ja,yr.prototype.has=za,yr.prototype.set=Ma;function Br(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Fi(){this.size=0,this.__data__={hash:new He,map:new(We||yr),string:new He}}function Ua(v){var I=ci(this,v).delete(v);return this.size-=I?1:0,I}function Bi(v){return ci(this,v).get(v)}function Ha(v){return ci(this,v).has(v)}function ka(v,I){var j=ci(this,v),F=j.size;return j.set(v,I),this.size+=j.size==F?0:1,this}Br.prototype.clear=Fi,Br.prototype.delete=Ua,Br.prototype.get=Bi,Br.prototype.has=Ha,Br.prototype.set=ka;function Gi(v){var I=-1,j=v==null?0:v.length;for(this.__data__=new Br;++I<j;)this.add(v[I])}function sn(v){return this.__data__.set(v,s),this}function nn(v){return this.__data__.has(v)}Gi.prototype.add=Gi.prototype.push=sn,Gi.prototype.has=nn;function Rr(v){var I=this.__data__=new yr(v);this.size=I.size}function Ka(){this.__data__=new yr,this.size=0}function Va(v){var I=this.__data__,j=I.delete(v);return this.size=I.size,j}function Fa(v){return this.__data__.get(v)}function Ba(v){return this.__data__.has(v)}function an(v,I){var j=this.__data__;if(j instanceof yr){var F=j.__data__;if(!We||F.length<r-1)return F.push([v,I]),this.size=++j.size,this;j=this.__data__=new Br(F)}return j.set(v,I),this.size=j.size,this}Rr.prototype.clear=Ka,Rr.prototype.delete=Va,Rr.prototype.get=Fa,Rr.prototype.has=Ba,Rr.prototype.set=an;function on(v,I){var j=Qi(v),F=!j&&wn(v),ze=!j&&!F&&bs(v),he=!j&&!F&&!ze&&En(v),Fe=j||F||ze||he,xt=Fe?vt(v.length,String):[],Ee=xt.length;for(var Me in v)Te.call(v,Me)&&!(Fe&&(Me=="length"||ze&&(Me=="offset"||Me=="parent")||he&&(Me=="buffer"||Me=="byteLength"||Me=="byteOffset")||dn(Me,Ee)))&&xt.push(Me);return xt}function Oi(v,I){for(var j=v.length;j--;)if(mn(v[j][0],I))return j;return-1}function ws(v,I,j){var F=I(v);return Qi(v)?F:Oe(F,j(v))}function Ri(v){return v==null?v===void 0?Tt:ne:Bt&&Bt in Object(v)?fn(v):Ja(v)}function _s(v){return Ci(v)&&Ri(v)==y}function Ai(v,I,j,F,ze){return v===I?!0:v==null||I==null||!Ci(v)&&!Ci(I)?v!==v&&I!==I:cn(v,I,j,F,Ai,ze)}function cn(v,I,j,F,ze,he){var Fe=Qi(v),xt=Qi(I),Ee=Fe?m:zr(v),Me=xt?m:zr(I);Ee=Ee==y?ce:Ee,Me=Me==y?ce:Me;var pt=Ee==ce,Xt=Me==ce,Pt=Ee==Me;if(Pt&&bs(v)){if(!bs(I))return!1;Fe=!0,pt=!1}if(Pt&&!pt)return he||(he=new Rr),Fe||En(v)?Wi(v,I,j,F,ze,he):Wa(v,I,Ee,j,F,ze,he);if(!(j&a)){var Be=pt&&Te.call(v,"__wrapped__"),Gt=Xt&&Te.call(I,"__wrapped__");if(Be||Gt){var Ar=Be?v.value():v,vr=Gt?I.value():I;return he||(he=new Rr),ze(Ar,vr,j,F,he)}}return Pt?(he||(he=new Rr),ln(v,I,j,F,ze,he)):!1}function Ga(v){if(!bn(v)||yn(v))return!1;var I=Yi(v)?Lt:rt;return I.test(Gr(v))}function un(v){return Ci(v)&&_n(v.length)&&!!we[Ri(v)]}function hn(v){if(!vn(v))return Si(v);var I=[];for(var j in Object(v))Te.call(v,j)&&j!="constructor"&&I.push(j);return I}function Wi(v,I,j,F,ze,he){var Fe=j&a,xt=v.length,Ee=I.length;if(xt!=Ee&&!(Fe&&Ee>xt))return!1;var Me=he.get(v);if(Me&&he.get(I))return Me==I;var pt=-1,Xt=!0,Pt=j&u?new Gi:void 0;for(he.set(v,I),he.set(I,v);++pt<xt;){var Be=v[pt],Gt=I[pt];if(F)var Ar=Fe?F(Gt,Be,pt,I,v,he):F(Be,Gt,pt,v,I,he);if(Ar!==void 0){if(Ar)continue;Xt=!1;break}if(Pt){if(!_e(I,function(vr,Mr){if(!Ze(Pt,Mr)&&(Be===vr||ze(Be,vr,j,F,he)))return Pt.push(Mr)})){Xt=!1;break}}else if(!(Be===Gt||ze(Be,Gt,j,F,he))){Xt=!1;break}}return he.delete(v),he.delete(I),Xt}function Wa(v,I,j,F,ze,he,Fe){switch(j){case Vt:if(v.byteLength!=I.byteLength||v.byteOffset!=I.byteOffset)return!1;v=v.buffer,I=I.buffer;case Yt:return!(v.byteLength!=I.byteLength||!he(new Ft(v),new Ft(I)));case _:case S:case se:return mn(+v,+I);case R:return v.name==I.name&&v.message==I.message;case fe:case Q:return v==I+"";case Z:var xt=ke;case pe:var Ee=F&a;if(xt||(xt=Xe),v.size!=I.size&&!Ee)return!1;var Me=Fe.get(v);if(Me)return Me==I;F|=u,Fe.set(v,I);var pt=Wi(xt(v),xt(I),F,ze,he,Fe);return Fe.delete(v),pt;case xe:if(ut)return ut.call(v)==ut.call(I)}return!1}function ln(v,I,j,F,ze,he){var Fe=j&a,xt=Ji(v),Ee=xt.length,Me=Ji(I),pt=Me.length;if(Ee!=pt&&!Fe)return!1;for(var Xt=Ee;Xt--;){var Pt=xt[Xt];if(!(Fe?Pt in I:Te.call(I,Pt)))return!1}var Be=he.get(v);if(Be&&he.get(I))return Be==I;var Gt=!0;he.set(v,I),he.set(I,v);for(var Ar=Fe;++Xt<Ee;){Pt=xt[Xt];var vr=v[Pt],Mr=I[Pt];if(F)var Es=Fe?F(Mr,vr,Pt,I,v,he):F(vr,Mr,Pt,v,I,he);if(!(Es===void 0?vr===Mr||ze(vr,Mr,j,F,he):Es)){Gt=!1;break}Ar||(Ar=Pt=="constructor")}if(Gt&&!Ar){var Ti=v.constructor,Nt=I.constructor;Ti!=Nt&&"constructor"in v&&"constructor"in I&&!(typeof Ti=="function"&&Ti instanceof Ti&&typeof Nt=="function"&&Nt instanceof Nt)&&(Gt=!1)}return he.delete(v),he.delete(I),Gt}function Ji(v){return ws(v,Za,pn)}function ci(v,I){var j=v.__data__;return gn(I)?j[typeof I=="string"?"string":"hash"]:j.map}function hr(v,I){var j=Ae(v,I);return Ga(j)?j:void 0}function fn(v){var I=Te.call(v,Bt),j=v[Bt];try{v[Bt]=void 0;var F=!0}catch{}var ze=Rt.call(v);return F&&(I?v[Bt]=j:delete v[Bt]),ze}var pn=Fr?function(v){return v==null?[]:(v=Object(v),Pe(Fr(v),function(I){return Zt.call(v,I)}))}:je,zr=Ri;(st&&zr(new st(new ArrayBuffer(1)))!=Vt||We&&zr(new We)!=Z||nt&&zr(nt.resolve())!=ae||at&&zr(new at)!=pe||et&&zr(new et)!=yt)&&(zr=function(v){var I=Ri(v),j=I==ce?v.constructor:void 0,F=j?Gr(j):"";if(F)switch(F){case wt:return Vt;case _t:return Z;case ot:return ae;case bt:return pe;case ct:return yt}return I});function dn(v,I){return I=I??f,!!I&&(typeof v=="number"||Pi.test(v))&&v>-1&&v%1==0&&v<I}function gn(v){var I=typeof v;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?v!=="__proto__":v===null}function yn(v){return!!mt&&mt in v}function vn(v){var I=v&&v.constructor,j=typeof I=="function"&&I.prototype||Se;return v===j}function Ja(v){return Rt.call(v)}function Gr(v){if(v!=null){try{return it.call(v)}catch{}try{return v+""}catch{}}return""}function mn(v,I){return v===I||v!==v&&I!==I}var wn=_s(function(){return arguments}())?_s:function(v){return Ci(v)&&Te.call(v,"callee")&&!Zt.call(v,"callee")},Qi=Array.isArray;function Qa(v){return v!=null&&_n(v.length)&&!Yi(v)}var bs=oi||De;function Ya(v,I){return Ai(v,I)}function Yi(v){if(!bn(v))return!1;var I=Ri(v);return I==D||I==C||I==g||I==te}function _n(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function bn(v){var I=typeof v;return v!=null&&(I=="object"||I=="function")}function Ci(v){return v!=null&&typeof v=="object"}var En=ge?lt(ge):un;function Za(v){return Qa(v)?on(v):hn(v)}function je(){return[]}function De(){return!1}o.exports=Ya})(ba,ba.exports);var a1=ba.exports;const o1=Dc(a1);function c1(o,t){return t=t||{},new Promise(function(r,s){var a=new XMLHttpRequest,u=[],f=[],y={},m=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:m,headers:{keys:function(){return u},entries:function(){return f},get:function(_){return y[_.toLowerCase()]},has:function(_){return _.toLowerCase()in y}}}};for(var g in a.open(t.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(_,S,R){u.push(S=S.toLowerCase()),f.push([S,R]),y[S]=y[S]?y[S]+","+R:R}),r(m())},a.onerror=s,a.withCredentials=t.credentials=="include",t.headers)a.setRequestHeader(g,t.headers[g]);a.send(t.body||null)})}const u1=Object.freeze(Object.defineProperty({__proto__:null,default:c1},Symbol.toStringTag,{value:"Module"})),dl=Nc(u1);var h1=self.fetch||(self.fetch=dl.default||dl);const l1=Dc(h1);var f1={};function p1(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),f=u.charCodeAt(0);if(r[f]!==255)throw new TypeError(u+" is ambiguous");r[f]=a}var y=o.length,m=o.charAt(0),g=Math.log(y)/Math.log(256),_=Math.log(256)/Math.log(y);function S(C){if(C instanceof Uint8Array||(ArrayBuffer.isView(C)?C=new Uint8Array(C.buffer,C.byteOffset,C.byteLength):Array.isArray(C)&&(C=Uint8Array.from(C))),!(C instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(C.length===0)return"";for(var Z=0,se=0,ne=0,ce=C.length;ne!==ce&&C[ne]===0;)ne++,Z++;for(var ae=(ce-ne)*_+1>>>0,te=new Uint8Array(ae);ne!==ce;){for(var fe=C[ne],pe=0,Q=ae-1;(fe!==0||pe<se)&&Q!==-1;Q--,pe++)fe+=256*te[Q]>>>0,te[Q]=fe%y>>>0,fe=fe/y>>>0;if(fe!==0)throw new Error("Non-zero carry");se=pe,ne++}for(var xe=ae-se;xe!==ae&&te[xe]===0;)xe++;for(var Tt=m.repeat(Z);xe<ae;++xe)Tt+=o.charAt(te[xe]);return Tt}function R(C){if(typeof C!="string")throw new TypeError("Expected String");if(C.length===0)return new Uint8Array;var Z=0;if(C[Z]!==" "){for(var se=0,ne=0;C[Z]===m;)se++,Z++;for(var ce=(C.length-Z)*g+1>>>0,ae=new Uint8Array(ce);C[Z];){var te=r[C.charCodeAt(Z)];if(te===255)return;for(var fe=0,pe=ce-1;(te!==0||fe<ne)&&pe!==-1;pe--,fe++)te+=y*ae[pe]>>>0,ae[pe]=te%256>>>0,te=te/256>>>0;if(te!==0)throw new Error("Non-zero carry");ne=fe,Z++}if(C[Z]!==" "){for(var Q=ce-ne;Q!==ce&&ae[Q]===0;)Q++;for(var xe=new Uint8Array(se+(ce-Q)),Tt=se;Q!==ce;)xe[Tt++]=ae[Q++];return xe}}}function D(C){var Z=R(C);if(Z)return Z;throw new Error(`Non-${t} character`)}return{encode:S,decodeUnsafe:R,decode:D}}var d1=p1,g1=d1;const pf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},y1=o=>new TextEncoder().encode(o),v1=o=>new TextDecoder().decode(o);class m1{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class w1{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return df(this,t)}}class _1{constructor(t){this.decoders=t}or(t){return df(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const df=(o,t)=>new _1({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class b1{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new m1(t,r,s),this.decoder=new w1(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Ca=({name:o,prefix:t,encode:r,decode:s})=>new b1(o,t,r,s),rn=({prefix:o,name:t,alphabet:r})=>{const{encode:s,decode:a}=g1(r,t);return Ca({prefix:o,name:t,encode:s,decode:u=>pf(a(u))})},E1=(o,t,r,s)=>{const a={};for(let _=0;_<t.length;++_)a[t[_]]=_;let u=o.length;for(;o[u-1]==="=";)--u;const f=new Uint8Array(u*r/8|0);let y=0,m=0,g=0;for(let _=0;_<u;++_){const S=a[o[_]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|S,y+=r,y>=8&&(y-=8,f[g++]=255&m>>y)}if(y>=r||255&m<<8-y)throw new SyntaxError("Unexpected end of data");return f},I1=(o,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",f=0,y=0;for(let m=0;m<o.length;++m)for(y=y<<8|o[m],f+=8;f>r;)f-=r,u+=t[a&y>>f];if(f&&(u+=t[a&y<<r-f]),s)for(;u.length*r&7;)u+="=";return u},Mt=({name:o,prefix:t,bitsPerChar:r,alphabet:s})=>Ca({prefix:t,name:o,encode(a){return I1(a,s,r)},decode(a){return E1(a,s,r,o)}}),x1=Ca({prefix:"\0",name:"identity",encode:o=>v1(o),decode:o=>y1(o)});var P1=Object.freeze({__proto__:null,identity:x1});const S1=Mt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var O1=Object.freeze({__proto__:null,base2:S1});const R1=Mt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var A1=Object.freeze({__proto__:null,base8:R1});const C1=rn({prefix:"9",name:"base10",alphabet:"0123456789"});var T1=Object.freeze({__proto__:null,base10:C1});const $1=Mt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),N1=Mt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var D1=Object.freeze({__proto__:null,base16:$1,base16upper:N1});const q1=Mt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),L1=Mt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),j1=Mt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),z1=Mt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),M1=Mt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),U1=Mt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),H1=Mt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),k1=Mt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),K1=Mt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var V1=Object.freeze({__proto__:null,base32:q1,base32upper:L1,base32pad:j1,base32padupper:z1,base32hex:M1,base32hexupper:U1,base32hexpad:H1,base32hexpadupper:k1,base32z:K1});const F1=rn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),B1=rn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var G1=Object.freeze({__proto__:null,base36:F1,base36upper:B1});const W1=rn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),J1=rn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Q1=Object.freeze({__proto__:null,base58btc:W1,base58flickr:J1});const Y1=Mt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Z1=Mt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),X1=Mt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),eb=Mt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var tb=Object.freeze({__proto__:null,base64:Y1,base64pad:Z1,base64url:X1,base64urlpad:eb});const gf=Array.from(""),rb=gf.reduce((o,t,r)=>(o[r]=t,o),[]),ib=gf.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function sb(o){return o.reduce((t,r)=>(t+=rb[r],t),"")}function nb(o){const t=[];for(const r of o){const s=ib[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const ab=Ca({prefix:"",name:"base256emoji",encode:sb,decode:nb});var ob=Object.freeze({__proto__:null,base256emoji:ab}),cb=yf,gl=128,ub=127,hb=~ub,lb=Math.pow(2,31);function yf(o,t,r){t=t||[],r=r||0;for(var s=r;o>=lb;)t[r++]=o&255|gl,o/=128;for(;o&hb;)t[r++]=o&255|gl,o>>>=7;return t[r]=o|0,yf.bytes=r-s+1,t}var fb=Sc,pb=128,yl=127;function Sc(o,s){var r=0,s=s||0,a=0,u=s,f,y=o.length;do{if(u>=y)throw Sc.bytes=0,new RangeError("Could not decode varint");f=o[u++],r+=a<28?(f&yl)<<a:(f&yl)*Math.pow(2,a),a+=7}while(f>=pb);return Sc.bytes=u-s,r}var db=Math.pow(2,7),gb=Math.pow(2,14),yb=Math.pow(2,21),vb=Math.pow(2,28),mb=Math.pow(2,35),wb=Math.pow(2,42),_b=Math.pow(2,49),bb=Math.pow(2,56),Eb=Math.pow(2,63),Ib=function(o){return o<db?1:o<gb?2:o<yb?3:o<vb?4:o<mb?5:o<wb?6:o<_b?7:o<bb?8:o<Eb?9:10},xb={encode:cb,decode:fb,encodingLength:Ib},vf=xb;const vl=(o,t,r=0)=>(vf.encode(o,t,r),t),ml=o=>vf.encodingLength(o),Oc=(o,t)=>{const r=t.byteLength,s=ml(o),a=s+ml(r),u=new Uint8Array(a+r);return vl(o,u,0),vl(r,u,s),u.set(t,a),new Pb(o,r,t,u)};class Pb{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const mf=({name:o,code:t,encode:r})=>new Sb(o,t,r);class Sb{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Oc(this.code,r):r.then(s=>Oc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const wf=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),Ob=mf({name:"sha2-256",code:18,encode:wf("SHA-256")}),Rb=mf({name:"sha2-512",code:19,encode:wf("SHA-512")});var Ab=Object.freeze({__proto__:null,sha256:Ob,sha512:Rb});const _f=0,Cb="identity",bf=pf,Tb=o=>Oc(_f,bf(o)),$b={code:_f,name:Cb,encode:bf,digest:Tb};var Nb=Object.freeze({__proto__:null,identity:$b});new TextEncoder,new TextDecoder;const wl={...P1,...O1,...A1,...T1,...D1,...V1,...G1,...Q1,...tb,...ob};({...Ab,...Nb});function Ef(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function Db(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ef(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function If(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const _l=If("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),hc=If("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=Db(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),qb={utf8:_l,"utf-8":_l,hex:wl.base16,latin1:hc,ascii:hc,binary:hc,...wl};function Lb(o,t="utf8"){const r=qb[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ef(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const xf="wc",jb=2,Hc="core",bi=`${xf}@2:${Hc}:`,zb={name:Hc,logger:"error"},Mb={database:":memory:"},Ub="crypto",bl="client_ed25519_seed",Hb=X.ONE_DAY,kb="keychain",Kb="0.3",Vb="messages",Fb="0.3",Bb=X.SIX_HOURS,Gb="publisher",Pf="irn",Wb="error",Sf="wss://relay.walletconnect.com",El="wss://relay.walletconnect.org",Jb="relayer",Kt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Qb="_subscription",ii={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Yb=X.ONE_SECOND,Zb="2.11.0",Xb=1e4,eE="0.3",tE="WALLETCONNECT_CLIENT_ID",Dr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},rE="subscription",iE="0.3",sE=X.FIVE_SECONDS*1e3,nE="pairing",aE="0.3",Us={wc_pairingDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:X.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:X.ONE_DAY,prompt:!1,tag:0},res:{ttl:X.ONE_DAY,prompt:!1,tag:0}}},Bs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},oE="history",cE="0.3",uE="expirer",Pr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},hE="0.3",lc="verify-api",gs="https://verify.walletconnect.com",Rc="https://verify.walletconnect.org",lE=[gs,Rc],fE="echo",pE="https://echo.walletconnect.com";class dE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=kb,this.version=Kb,this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=B("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Yl(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Zl(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class gE{constructor(t,r,s){this.core=t,this.logger=r,this.name=Ub,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=ll(a);return ff(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=g0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),f=ll(u),y=wc();return await e1(y,a,Hb,f)},this.generateSharedKey=(a,u,f)=>{this.isInitialized();const y=this.getPrivateKey(a),m=y0(y,u);return this.setSymKey(m,f)},this.setSymKey=async(a,u)=>{this.isInitialized();const f=u||v0(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,f)=>{this.isInitialized();const y=m0(f),m=Zs(u);if(Fh(y)){const R=y.senderPublicKey,D=y.receiverPublicKey;a=await this.generateSharedKey(R,D)}const g=this.getSymKey(a),{type:_,senderPublicKey:S}=y;return w0({type:_,symKey:g,message:m,senderPublicKey:S})},this.decode=async(a,u,f)=>{this.isInitialized();const y=_0(u,f);if(Fh(y)){const m=y.receiverPublicKey,g=y.senderPublicKey;a=await this.generateSharedKey(m,g)}try{const m=this.getSymKey(a),g=b0({symKey:m,encoded:u});return xa(g)}catch(m){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=a=>{const u=Bh(a);return E0(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Bh(a);return u.senderPublicKey?Ia(u.senderPublicKey,I0):void 0},this.core=t,this.logger=cr(r,this.name),this.keychain=s||new dE(this.core,this.logger)}get context(){return or(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(bl)}catch{t=wc(),await this.keychain.set(bl,t)}return Lb(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class yE extends T_{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=Vb,this.version=Fb,this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=ys(a);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[u]<"u"||(f[u]=a,this.messages.set(s,f),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),f=ys(a);return typeof u[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=cr(t,this.name),this.core=r}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Yl(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Zl(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class vE extends $_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Sr.EventEmitter,this.name=Gb,this.queue=new Map,this.publishTimeout=X.toMiliseconds(X.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const y=(u==null?void 0:u.ttl)||Bb,m=_c(u),g=(u==null?void 0:u.prompt)||!1,_=(u==null?void 0:u.tag)||0,S=(u==null?void 0:u.id)||jc().toString(),R={topic:s,message:a,opts:{ttl:y,relay:m,prompt:g,tag:_,id:S}},D=setTimeout(()=>this.queue.set(S,R),this.publishTimeout);try{await await Ws(this.rpcPublish(s,a,y,m,g,_,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Kt.publish,R)}catch(C){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=u==null?void 0:u.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(S),C;return}finally{clearTimeout(D)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=cr(r,this.name),this.registerEventListeners()}get context(){return or(this.logger)}rpcPublish(t,r,s,a,u,f,y){var m,g,_,S;const R={method:ya(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:f},id:y};return _i((m=R.params)==null?void 0:m.prompt)&&((g=R.params)==null||delete g.prompt),_i((_=R.params)==null?void 0:_.tag)&&((S=R.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Kt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Kt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class mE{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var wE=Object.defineProperty,_E=Object.defineProperties,bE=Object.getOwnPropertyDescriptors,Il=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,IE=Object.prototype.propertyIsEnumerable,xl=(o,t,r)=>t in o?wE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Hs=(o,t)=>{for(var r in t||(t={}))EE.call(t,r)&&xl(o,r,t[r]);if(Il)for(var r of Il(t))IE.call(t,r)&&xl(o,r,t[r]);return o},fc=(o,t)=>_E(o,bE(t));class xE extends q_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new mE,this.events=new Sr.EventEmitter,this.name=rE,this.version=iE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=bi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=_c(a),f={topic:s,relay:u};this.pending.set(s,f);const y=await this.rpcSubscribe(s,u);return this.onSubscribe(y,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),y}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const f=new X.Watch;f.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=sE&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=cr(r,this.name),this.clientId=""}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=_c(s);await this.rpcUnsubscribe(t,r,a);const u=kt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:ya(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Ws(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}return ys(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:ya(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Ws(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:ya(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,fc(Hs({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Hs({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Hs({},r)),this.topicMap.set(r.topic,t),this.events.emit(Dr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Dr.deleted,fc(Hs({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Dr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);vs(r)&&this.onBatchSubscribe(r.map((s,a)=>fc(Hs({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Kt.connect,async()=>{await this.onConnect()}),this.relayer.on(Kt.disconnect,()=>{this.onDisconnect()}),this.events.on(Dr.created,async t=>{const r=Dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Dr.deleted,async t=>{const r=Dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var PE=Object.defineProperty,Pl=Object.getOwnPropertySymbols,SE=Object.prototype.hasOwnProperty,OE=Object.prototype.propertyIsEnumerable,Sl=(o,t,r)=>t in o?PE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,RE=(o,t)=>{for(var r in t||(t={}))SE.call(t,r)&&Sl(o,r,t[r]);if(Pl)for(var r of Pl(t))OE.call(t,r)&&Sl(o,r,t[r]);return o};class AE extends N_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Sr.EventEmitter,this.name=Jb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Kt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Kt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ii.payload,this.onPayloadHandler),this.provider.on(ii.connect,this.onConnectHandler),this.provider.on(ii.disconnect,this.onDisconnectHandler),this.provider.on(ii.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?cr(t.logger,this.name):Ra(Aa({level:t.logger||Wb})),this.messages=new yE(this.logger,t.core),this.subscriber=new xE(this,this.logger),this.publisher=new vE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Sf,this.projectId=t.projectId,this.bundleId=x0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${El}...`),await this.restartTransport(El)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Xb)}get context(){return or(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const f=y=>{y.topic===t&&(this.subscriber.off(Dr.created,f),u())};return await Promise.all([new Promise(y=>{u=y,this.subscriber.on(Dr.created,f)}),new Promise(async y=>{a=await this.subscriber.subscribe(t,r),y()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ws(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Dr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await Ws(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ii.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Gh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new t1(new n1(P0({sdkVersion:Zb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Mc(t)){if(!t.method.endsWith(Qb))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,f={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(RE({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else Xs(t)&&this.events.emit(Kt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Kt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Pa(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ii.payload,this.onPayloadHandler),this.provider.off(ii.connect,this.onConnectHandler),this.provider.off(ii.disconnect,this.onDisconnectHandler),this.provider.off(ii.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Kt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Gh();S0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Kt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},X.toMiliseconds(Yb)))}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var CE=Object.defineProperty,Ol=Object.getOwnPropertySymbols,TE=Object.prototype.hasOwnProperty,$E=Object.prototype.propertyIsEnumerable,Rl=(o,t,r)=>t in o?CE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Al=(o,t)=>{for(var r in t||(t={}))TE.call(t,r)&&Rl(o,r,t[r]);if(Ol)for(var r of Ol(t))$E.call(t,r)&&Rl(o,r,t[r]);return o};class Ta extends D_{constructor(t,r,s,a=bi,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=eE,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!_i(f)?this.map.set(this.getKey(f),f):p0(f)?this.map.set(f.id,f):d0(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,y)=>{this.isInitialized(),this.map.has(f)?await this.update(f,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:y}),this.map.set(f,y),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(y=>Object.keys(f).every(m=>o1(y[m],f[m]))):this.values),this.update=async(f,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:y});const m=Al(Al({},this.getData(f)),y);this.map.set(f,m),await this.persist()},this.delete=async(f,y)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:y}),this.map.delete(f),await this.persist())},this.logger=cr(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class NE{constructor(t,r){this.core=t,this.logger=r,this.name=nE,this.version=aE,this.events=new Lc,this.initialized=!1,this.storagePrefix=bi,this.ignoredPayloadTypes=[Wl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=wc(),a=await this.core.crypto.setSymKey(s),u=qr(X.FIVE_MINUTES),f={protocol:Pf},y={topic:a,expiry:u,relay:f,active:!1},m=O0({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:f});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:m}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:f}=Wh(s.uri);let y;if(this.pairings.keys.includes(a)&&(y=this.pairings.get(a),y.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const m=qr(X.FIVE_MINUTES),g={topic:a,relay:f,expiry:m,active:!1};return await this.pairings.set(a,g),this.core.expirer.set(a,m),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Bs.create,g),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:f})),g},this.activate=async({topic:s})=>{this.isInitialized();const a=qr(X.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:y,reject:m}=ps();this.events.once(St("pairing_ping",u),({error:g})=>{g?m(g):y()}),await f()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",kt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const f=Hi(a,u),y=await this.core.crypto.encode(s,f),m=Us[a].req;return this.core.history.set(s,f),this.core.relayer.publish(s,y,m),f.id},this.sendResult=async(s,a,u)=>{const f=Pa(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),g=Us[m.request.method].res;await this.core.relayer.publish(a,y,g),await this.core.history.resolve(f)},this.sendError=async(s,a,u)=>{const f=zc(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),g=Us[m.request.method]?Us[m.request.method].res:Us.unregistered_method.res;await this.core.relayer.publish(a,y,g),await this.core.history.resolve(f)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,kt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>wi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,f=(await this.core.history.get(a,u.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(Bs.ping,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{mi(a)?this.events.emit(St("pairing_ping",u),{}):Lr(a)&&this.events.emit(St("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Bs.delete,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:f}=a;try{if(this.registeredMethods.includes(f))return;const y=kt("WC_METHOD_UNSUPPORTED",f);await this.sendError(u,s,y),this.logger.error(y)}catch(y){await this.sendError(u,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(kt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!ar(s)){const{message:f}=B("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(f)}if(!R0(s.uri)){const{message:f}=B("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(f)}const u=Wh(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(u!=null&&u.symKey)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!ds(s,!1)){const{message:a}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(wi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=B("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=cr(r,this.name),this.pairings=new Ta(this.core,this.logger,this.name,this.storagePrefix)}get context(){return or(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Kt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{Mc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Xs(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Pr.expired,async t=>{const{topic:r}=Jl(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Bs.expire,{topic:r}))})}}class DE extends C_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Sr.EventEmitter,this.name=oE,this.version=cE,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const f={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:qr(X.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Kr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=Lr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Kr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(Kr.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Hi(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Kr.created,t=>{const r=Kr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.updated,t=>{const r=Kr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.deleted,t=>{const r=Kr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{X.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class qE extends L_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Sr.EventEmitter,this.name=uE,this.version=hE,this.cached=[],this.initialized=!1,this.storagePrefix=bi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),f={target:u,expiry:a};this.expirations.set(u,f),this.checkExpiry(u,f),this.events.emit(Pr.created,{target:u,expiration:f})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Pr.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return A0(t);if(typeof t=="number")return C0(t);const{message:r}=B("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Pr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;X.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Pr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Pr.created,t=>{const r=Pr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.expired,t=>{const r=Pr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.deleted,t=>{const r=Pr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class LE extends j_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=lc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||T0()||!Ql())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Rc;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(f),u=await this.fetchAttestation(s.attestationId,Rc)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(X.ONE_SECOND*2),f=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),f.status===200?await f.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(lc))return u();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=lc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=u}),new Promise((u,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},X.toMiliseconds(X.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||gs;return lE.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${gs}`),a=gs),a},this.logger=cr(r,this.name),this.verifyUrl=gs,this.abortController=new AbortController,this.isDevEnv=$0()&&f1.IS_VITEST}get context(){return or(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),X.toMiliseconds(t))}}class jE extends z_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=fE,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:f,enableEncrypted:y=!1}=s,m=`${pE}/${this.projectId}/clients`;await l1(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:f,token:u,always_raw:y})})},this.logger=cr(r,this.context)}}var zE=Object.defineProperty,Cl=Object.getOwnPropertySymbols,ME=Object.prototype.hasOwnProperty,UE=Object.prototype.propertyIsEnumerable,Tl=(o,t,r)=>t in o?zE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,$l=(o,t)=>{for(var r in t||(t={}))ME.call(t,r)&&Tl(o,r,t[r]);if(Cl)for(var r of Cl(t))UE.call(t,r)&&Tl(o,r,t[r]);return o};class kc extends A_{constructor(t){super(t),this.protocol=xf,this.version=jb,this.name=Hc,this.events=new Sr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Sf,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ra(Aa({level:(t==null?void 0:t.logger)||zb.logger}));this.logger=cr(r,this.name),this.heartbeat=new ms.HeartBeat,this.crypto=new gE(this,this.logger,t==null?void 0:t.keychain),this.history=new DE(this,this.logger),this.expirer=new qE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new $w($l($l({},Mb),t==null?void 0:t.storageOptions)),this.relayer=new AE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new NE(this,this.logger),this.verify=new LE(this.projectId||"",this.logger),this.echoClient=new jE(this.projectId||"",this.logger)}static async init(t){const r=new kc(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(tE,s),r}get context(){return or(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const HE=kc,Of="wc",Rf=2,Af="client",Kc=`${Of}@${Rf}:${Af}:`,pc={name:Af,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Nl="WALLETCONNECT_DEEPLINK_CHOICE",kE="proposal",Cf="Proposal expired",KE="session",pa=X.SEVEN_DAYS,VE="engine",ks={wc_sessionPropose:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1104},res:{ttl:X.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1106},res:{ttl:X.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1112},res:{ttl:X.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1115}}},dc={min:X.FIVE_MINUTES,max:X.SEVEN_DAYS},si={idle:"IDLE",active:"ACTIVE"},FE="request",BE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var GE=Object.defineProperty,WE=Object.defineProperties,JE=Object.getOwnPropertyDescriptors,Dl=Object.getOwnPropertySymbols,QE=Object.prototype.hasOwnProperty,YE=Object.prototype.propertyIsEnumerable,ql=(o,t,r)=>t in o?GE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,sr=(o,t)=>{for(var r in t||(t={}))QE.call(t,r)&&ql(o,r,t[r]);if(Dl)for(var r of Dl(t))YE.call(t,r)&&ql(o,r,t[r]);return o},Ks=(o,t)=>WE(o,JE(t));class ZE extends U_{constructor(t){super(t),this.name=VE,this.events=new Lc,this.initialized=!1,this.ignoredPayloadTypes=[Wl],this.requestQueue={state:si.idle,queue:[]},this.sessionRequestQueue={state:si.idle,queue:[]},this.requestQueueDelay=X.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(ks)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Ks(sr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:f,sessionProperties:y,relays:m}=s;let g=a,_,S=!1;if(g&&(S=this.client.core.pairing.pairings.get(g).active),!g||!S){const{topic:ae,uri:te}=await this.client.core.pairing.create();g=ae,_=te}const R=await this.client.core.crypto.generateKeyPair(),D=sr({requiredNamespaces:u,optionalNamespaces:f,relays:m??[{protocol:Pf}],proposer:{publicKey:R,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:C,resolve:Z,done:se}=ps(X.FIVE_MINUTES,Cf);if(this.events.once(St("session_connect"),async({error:ae,session:te})=>{if(ae)C(ae);else if(te){te.self.publicKey=R;const fe=Ks(sr({},te),{requiredNamespaces:te.requiredNamespaces,optionalNamespaces:te.optionalNamespaces});await this.client.session.set(te.topic,fe),await this.setExpiry(te.topic,te.expiry),g&&await this.client.core.pairing.updateMetadata({topic:g,metadata:te.peer.metadata}),Z(fe)}}),!g){const{message:ae}=B("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(ae)}const ne=await this.sendRequest({topic:g,method:"wc_sessionPropose",params:D}),ce=qr(X.FIVE_MINUTES);return await this.setProposal(ne,sr({id:ne,expiry:ce},D)),{uri:_,approval:se}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:f}=r,y=this.client.proposal.get(s);let{pairingTopic:m,proposer:g,requiredNamespaces:_,optionalNamespaces:S}=y;m=m||"",va(_)||(_=D0(u,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),D=g.publicKey,C=await this.client.core.crypto.generateSharedKey(R,D);m&&s&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:g.metadata}),await this.sendResult({id:s,topic:m,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const Z=sr({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:_,optionalNamespaces:S,pairingTopic:m,controller:{publicKey:R,metadata:this.client.metadata},expiry:qr(pa)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(C),await this.sendRequest({topic:C,method:"wc_sessionSettle",params:Z,throwOnFailedPublish:!0});const se=Ks(sr({},Z),{topic:C,pairingTopic:m,acknowledged:!1,self:Z.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:R});return await this.client.session.set(C,se),await this.setExpiry(C,qr(pa)),{topic:C,acknowledged:()=>new Promise(ne=>setTimeout(()=>ne(this.client.session.get(C)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:y,reject:m}=ps();return this.events.once(St("session_update",u),({error:g})=>{g?m(g):y()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:f,reject:y}=ps();return this.events.once(St("session_extend",a),({error:m})=>{m?y(m):f()}),await this.setExpiry(s,qr(pa)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:f}=r,y=rw(),{done:m,resolve:g,reject:_}=ps(f,"Request expired. Please try again.");return this.events.once(St("session_request",y),({error:S,result:R})=>{S?_(S):g(R)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:y,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch(R=>_(R)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:y}),S()}),new Promise(async S=>{const R=await q0(this.client.core.storage,Nl);L0({id:y,topic:u,wcDeepLink:R}),S()}),m()]).then(S=>S[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;mi(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):Lr(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:f,reject:y}=ps();this.events.once(St("session_ping",a),({error:m})=>{m?y(m):f()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:kt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>j0(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var f,y;return((f=u.peerMetadata)==null?void 0:f.url)&&((y=u.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,kt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Nl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,kt("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,kt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=si.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=ks.wc_sessionRequest.req.ttl,{id:a,topic:u,params:f,verifyContext:y}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:f,verifyContext:y}),s&&this.client.core.expirer.set(a,qr(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:f,relayRpcId:y,clientRpcId:m,throwOnFailedPublish:g}=r,_=Hi(a,u,m);if(Ql()&&BE.includes(a)){const D=ys(JSON.stringify(_));this.client.core.verify.register({attestationId:D})}const S=await this.client.core.crypto.encode(s,_),R=ks[a].req;return f&&(R.ttl=f),y&&(R.id=y),this.client.core.history.set(s,_),g?(R.internal=Ks(sr({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,R)):this.client.core.relayer.publish(s,S,R).catch(D=>this.client.logger.error(D)),_.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:f}=r,y=Pa(s,u),m=await this.client.core.crypto.encode(a,y),g=await this.client.core.history.get(a,s),_=ks[g.request.method].res;f?(_.internal=Ks(sr({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,m,_)):this.client.core.relayer.publish(a,m,_).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(y)},this.sendError=async(r,s,a)=>{const u=zc(r,a),f=await this.client.core.crypto.encode(s,u),y=await this.client.core.history.get(s,r),m=ks[y.request.method].res;this.client.core.relayer.publish(s,f,m),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{wi(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{wi(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===si.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=si.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=si.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=B("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(sr({},s.params));const f=qr(X.FIVE_MINUTES),y=sr({id:u,pairingTopic:r,expiry:f},a);await this.setProposal(u,y);const m=ys(JSON.stringify(s)),g=await this.getVerifyContext(m,y.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:y,verifyContext:g})}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(mi(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const y=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const m=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const g=await this.client.core.crypto.generateSharedKey(y,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const _=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else Lr(s)&&(await this.client.proposal.delete(a,kt("USER_DISCONNECTED")),this.events.emit(St("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:f,controller:y,expiry:m,namespaces:g,requiredNamespaces:_,optionalNamespaces:S,sessionProperties:R,pairingTopic:D}=s.params,C=sr({topic:r,relay:f,expiry:m,namespaces:g,acknowledged:!0,pairingTopic:D,requiredNamespaces:_,optionalNamespaces:S,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},R&&{sessionProperties:R});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(St("session_connect"),{session:C}),this.cleanupDuplicatePairings(C)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;mi(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(St("session_approve",a),{})):Lr(s)&&(await this.client.session.delete(r,kt("USER_DISCONNECTED")),this.events.emit(St("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const f=`${r}_session_update`,y=ua.get(f);if(y&&this.isRequestOutOfSync(y,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(sr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),ua.set(f,u)}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;mi(s)?this.events.emit(St("session_update",a),{}):Lr(s)&&this.events.emit(St("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,qr(pa)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;mi(s)?this.events.emit(St("session_extend",a),{}):Lr(s)&&this.events.emit(St("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{mi(s)?this.events.emit(St("session_ping",a),{}):Lr(s)&&this.events.emit(St("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Kt.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(sr({topic:r},u));const f=ys(JSON.stringify(Hi("wc_sessionRequest",u,a))),y=this.client.session.get(r),m=await this.getVerifyContext(f,y.peer.metadata),g={id:a,topic:r,params:u,verifyContext:m};await this.setPendingSessionRequest(g),this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue()}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;mi(s)?this.events.emit(St("session_request",a),{result:s.result}):Lr(s)&&this.events.emit(St("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const f=`${r}_session_event_${u.event.name}`,y=ua.get(f);if(y&&this.isRequestOutOfSync(y,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(sr({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),ua.set(f,a)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=si.idle,this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===si.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=si.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Hi("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(m)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:f,relays:y}=r;if(_i(s)||await this.isValidPairingTopic(s),!z0(y)){const{message:m}=B("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(m)}!_i(a)&&va(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!_i(u)&&va(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),_i(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=M0(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!ar(r))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:f}=r;await this.isValidProposalId(s);const y=this.client.proposal.get(s),m=ic(a,"approve()");if(m)throw new Error(m.message);const g=Jh(y.requiredNamespaces,a,"approve()");if(g)throw new Error(g.message);if(!ds(u,!0)){const{message:_}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(_)}_i(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!ar(r)){const{message:u}=B("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!U0(a)){const{message:u}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!ar(r)){const{message:g}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(g)}const{relay:s,controller:a,namespaces:u,expiry:f}=r;if(!H0(s)){const{message:g}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const y=k0(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const m=ic(u,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(wi(f)){const{message:g}=B("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(m)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),f=ic(a,"update()");if(f)throw new Error(f.message);const y=Jh(u.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(m)}const{topic:s,request:a,chainId:u,expiry:f}=r;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!Qh(y,u)){const{message:m}=B("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(m)}if(!K0(a)){const{message:m}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(m)}if(!V0(y,u,a.method)){const{message:m}=B("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(m)}if(f&&!F0(f,dc)){const{message:m}=B("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${dc.min} and ${dc.max}`);throw new Error(m)}},this.isValidRespond=async r=>{var s;if(!ar(r)){const{message:f}=B("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(f)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(f){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),f}if(!B0(u)){const{message:f}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(f)}},this.isValidPing=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!ar(r)){const{message:y}=B("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!Qh(f,u)){const{message:y}=B("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(y)}if(!G0(a)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!W0(f,u,a.name)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||gs,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!ds(a,!1)){const{message:u}=B("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Kt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{Mc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Xs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(Pr.expired,async t=>{const{topic:r,id:s}=Jl(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,B("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Bs.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!ds(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(wi(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=B("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!ds(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(wi(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=B("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(ds(t,!1)){const{message:r}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!J0(t)){const{message:r}=B("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(wi(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=B("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class XE extends Ta{constructor(t,r){super(t,r,kE,Kc),this.core=t,this.logger=r}}class eI extends Ta{constructor(t,r){super(t,r,KE,Kc),this.core=t,this.logger=r}}class tI extends Ta{constructor(t,r){super(t,r,FE,Kc,s=>s.id),this.core=t,this.logger=r}}let rI=class Tf extends M_{constructor(t){super(t),this.protocol=Of,this.version=Rf,this.name=pc.name,this.events=new Sr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||pc.name,this.metadata=(t==null?void 0:t.metadata)||N0();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ra(Aa({level:(t==null?void 0:t.logger)||pc.logger}));this.core=(t==null?void 0:t.core)||new HE(t),this.logger=cr(r,this.name),this.session=new eI(this.core,this.logger),this.proposal=new XE(this.core,this.logger),this.pendingRequest=new tI(this.core,this.logger),this.engine=new ZE(this)}static async init(t){const r=new Tf(t);return await r.initialize(),r}get context(){return or(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};class xi extends ef{constructor(t){super(t),this.events=new Sr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Hi(t.method,t.params||[],t.id||jc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{Lr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Xs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Ll="error",iI="wss://relay.walletconnect.com",sI="wc",nI="universal_provider",jl=`${sI}@2:${nI}:`,aI="https://rpc.walletconnect.com/v1/",ai={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ni<"u"?ni:typeof self<"u"?self:{},Ac={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",y="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",g=500,_="__lodash_placeholder__",S=1,R=2,D=4,C=1,Z=2,se=1,ne=2,ce=4,ae=8,te=16,fe=32,pe=64,Q=128,xe=256,Tt=512,yt=30,Yt="...",Vt=800,ur=16,M=1,U=2,Ge=3,qe=1/0,G=9007199254740991,K=17976931348623157e292,H=NaN,V=4294967295,Ot=V-1,rt=V>>>1,Pi=[["ary",Q],["bind",se],["bindKey",ne],["curry",ae],["curryRight",te],["flip",Tt],["partial",fe],["partialRight",pe],["rearg",xe]],we="[object Arguments]",Or="[object Array]",$="[object AsyncFunction]",T="[object Boolean]",O="[object Date]",h="[object DOMException]",E="[object Error]",J="[object Function]",oe="[object GeneratorFunction]",ge="[object Map]",Pe="[object Number]",Oe="[object Null]",_e="[object Object]",vt="[object Promise]",lt="[object Proxy]",Ze="[object RegExp]",Ae="[object Set]",ke="[object String]",Ke="[object Symbol]",Xe="[object Undefined]",Ne="[object WeakMap]",Ve="[object WeakSet]",Se="[object ArrayBuffer]",Le="[object DataView]",it="[object Float32Array]",Te="[object Float64Array]",mt="[object Int8Array]",Rt="[object Int16Array]",Lt="[object Int32Array]",jt="[object Uint8Array]",$t="[object Uint8ClampedArray]",Ft="[object Uint16Array]",Zt="[object Uint32Array]",jr=/\b__p \+= '';/g,Bt=/\b(__p \+=) '' \+/g,Fr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,oi=/&(?:amp|lt|gt|quot|#39);/g,Si=/[&<>"']/g,st=RegExp(oi.source),We=RegExp(Si.source),nt=/<%-([\s\S]+?)%>/g,at=/<%([\s\S]+?)%>/g,et=/<%=([\s\S]+?)%>/g,Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wt=/^\w*$/,_t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/[\\^$.*+?()[\]{}|]/g,bt=RegExp(ot.source),ct=/^\s+/,ft=/\s/,ut=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,He=/\{\n\/\* \[wrapped with (.+)\] \*/,Et=/,? & /,It=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,$a=/[()=,{}\[\]\/\s]/,Na=/\\(\\)?/g,Da=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,yr=/\w*$/,qa=/^[-+]0x[0-9a-f]+$/i,La=/^0b[01]+$/i,ja=/^\[object .+?Constructor\]$/,za=/^0o[0-7]+$/i,Ma=/^(?:0|[1-9]\d*)$/,Br=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Fi=/($^)/,Ua=/['\n\r\u2028\u2029\\]/g,Bi="\\ud800-\\udfff",Ha="\\u0300-\\u036f",ka="\\ufe20-\\ufe2f",Gi="\\u20d0-\\u20ff",sn=Ha+ka+Gi,nn="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",Ka="\\xac\\xb1\\xd7\\xf7",Va="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fa="\\u2000-\\u206f",Ba=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",an="A-Z\\xc0-\\xd6\\xd8-\\xde",on="\\ufe0e\\ufe0f",Oi=Ka+Va+Fa+Ba,ws="[']",Ri="["+Bi+"]",_s="["+Oi+"]",Ai="["+sn+"]",cn="\\d+",Ga="["+nn+"]",un="["+Rr+"]",hn="[^"+Bi+Oi+cn+nn+Rr+an+"]",Wi="\\ud83c[\\udffb-\\udfff]",Wa="(?:"+Ai+"|"+Wi+")",ln="[^"+Bi+"]",Ji="(?:\\ud83c[\\udde6-\\uddff]){2}",ci="[\\ud800-\\udbff][\\udc00-\\udfff]",hr="["+an+"]",fn="\\u200d",pn="(?:"+un+"|"+hn+")",zr="(?:"+hr+"|"+hn+")",dn="(?:"+ws+"(?:d|ll|m|re|s|t|ve))?",gn="(?:"+ws+"(?:D|LL|M|RE|S|T|VE))?",yn=Wa+"?",vn="["+on+"]?",Ja="(?:"+fn+"(?:"+[ln,Ji,ci].join("|")+")"+vn+yn+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",wn=vn+yn+Ja,Qi="(?:"+[Ga,Ji,ci].join("|")+")"+wn,Qa="(?:"+[ln+Ai+"?",Ai,Ji,ci,Ri].join("|")+")",bs=RegExp(ws,"g"),Ya=RegExp(Ai,"g"),Yi=RegExp(Wi+"(?="+Wi+")|"+Qa+wn,"g"),_n=RegExp([hr+"?"+un+"+"+dn+"(?="+[_s,hr,"$"].join("|")+")",zr+"+"+gn+"(?="+[_s,hr+pn,"$"].join("|")+")",hr+"?"+pn+"+"+dn,hr+"+"+gn,mn,Gr,cn,Qi].join("|"),"g"),bn=RegExp("["+fn+Bi+sn+on+"]"),Ci=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,En=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Za=-1,je={};je[it]=je[Te]=je[mt]=je[Rt]=je[Lt]=je[jt]=je[$t]=je[Ft]=je[Zt]=!0,je[we]=je[Or]=je[Se]=je[T]=je[Le]=je[O]=je[E]=je[J]=je[ge]=je[Pe]=je[_e]=je[Ze]=je[Ae]=je[ke]=je[Ne]=!1;var De={};De[we]=De[Or]=De[Se]=De[Le]=De[T]=De[O]=De[it]=De[Te]=De[mt]=De[Rt]=De[Lt]=De[ge]=De[Pe]=De[_e]=De[Ze]=De[Ae]=De[ke]=De[Ke]=De[jt]=De[$t]=De[Ft]=De[Zt]=!0,De[E]=De[J]=De[Ne]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},j={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},F={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ze=parseFloat,he=parseInt,Fe=typeof Vs=="object"&&Vs&&Vs.Object===Object&&Vs,xt=typeof self=="object"&&self&&self.Object===Object&&self,Ee=Fe||xt||Function("return this")(),Me=t&&!t.nodeType&&t,pt=Me&&!0&&o&&!o.nodeType&&o,Xt=pt&&pt.exports===Me,Pt=Xt&&Fe.process,Be=function(){try{var x=pt&&pt.require&&pt.require("util").types;return x||Pt&&Pt.binding&&Pt.binding("util")}catch{}}(),Gt=Be&&Be.isArrayBuffer,Ar=Be&&Be.isDate,vr=Be&&Be.isMap,Mr=Be&&Be.isRegExp,Es=Be&&Be.isSet,Ti=Be&&Be.isTypedArray;function Nt(x,N,A){switch(A.length){case 0:return x.call(N);case 1:return x.call(N,A[0]);case 2:return x.call(N,A[0],A[1]);case 3:return x.call(N,A[0],A[1],A[2])}return x.apply(N,A)}function Df(x,N,A,W){for(var ue=-1,Re=x==null?0:x.length;++ue<Re;){var At=x[ue];N(W,At,A(At),x)}return W}function mr(x,N){for(var A=-1,W=x==null?0:x.length;++A<W&&N(x[A],A,x)!==!1;);return x}function qf(x,N){for(var A=x==null?0:x.length;A--&&N(x[A],A,x)!==!1;);return x}function Bc(x,N){for(var A=-1,W=x==null?0:x.length;++A<W;)if(!N(x[A],A,x))return!1;return!0}function ui(x,N){for(var A=-1,W=x==null?0:x.length,ue=0,Re=[];++A<W;){var At=x[A];N(At,A,x)&&(Re[ue++]=At)}return Re}function In(x,N){var A=x==null?0:x.length;return!!A&&Zi(x,N,0)>-1}function Xa(x,N,A){for(var W=-1,ue=x==null?0:x.length;++W<ue;)if(A(N,x[W]))return!0;return!1}function Qe(x,N){for(var A=-1,W=x==null?0:x.length,ue=Array(W);++A<W;)ue[A]=N(x[A],A,x);return ue}function hi(x,N){for(var A=-1,W=N.length,ue=x.length;++A<W;)x[ue+A]=N[A];return x}function eo(x,N,A,W){var ue=-1,Re=x==null?0:x.length;for(W&&Re&&(A=x[++ue]);++ue<Re;)A=N(A,x[ue],ue,x);return A}function Lf(x,N,A,W){var ue=x==null?0:x.length;for(W&&ue&&(A=x[--ue]);ue--;)A=N(A,x[ue],ue,x);return A}function to(x,N){for(var A=-1,W=x==null?0:x.length;++A<W;)if(N(x[A],A,x))return!0;return!1}var jf=ro("length");function zf(x){return x.split("")}function Mf(x){return x.match(It)||[]}function Gc(x,N,A){var W;return A(x,function(ue,Re,At){if(N(ue,Re,At))return W=Re,!1}),W}function xn(x,N,A,W){for(var ue=x.length,Re=A+(W?1:-1);W?Re--:++Re<ue;)if(N(x[Re],Re,x))return Re;return-1}function Zi(x,N,A){return N===N?Yf(x,N,A):xn(x,Wc,A)}function Uf(x,N,A,W){for(var ue=A-1,Re=x.length;++ue<Re;)if(W(x[ue],N))return ue;return-1}function Wc(x){return x!==x}function Jc(x,N){var A=x==null?0:x.length;return A?so(x,N)/A:H}function ro(x){return function(N){return N==null?r:N[x]}}function io(x){return function(N){return x==null?r:x[N]}}function Qc(x,N,A,W,ue){return ue(x,function(Re,At,Ue){A=W?(W=!1,Re):N(A,Re,At,Ue)}),A}function Hf(x,N){var A=x.length;for(x.sort(N);A--;)x[A]=x[A].value;return x}function so(x,N){for(var A,W=-1,ue=x.length;++W<ue;){var Re=N(x[W]);Re!==r&&(A=A===r?Re:A+Re)}return A}function no(x,N){for(var A=-1,W=Array(x);++A<x;)W[A]=N(A);return W}function kf(x,N){return Qe(N,function(A){return[A,x[A]]})}function Yc(x){return x&&x.slice(0,tu(x)+1).replace(ct,"")}function lr(x){return function(N){return x(N)}}function ao(x,N){return Qe(N,function(A){return x[A]})}function Is(x,N){return x.has(N)}function Zc(x,N){for(var A=-1,W=x.length;++A<W&&Zi(N,x[A],0)>-1;);return A}function Xc(x,N){for(var A=x.length;A--&&Zi(N,x[A],0)>-1;);return A}function Kf(x,N){for(var A=x.length,W=0;A--;)x[A]===N&&++W;return W}var Vf=io(v),Ff=io(I);function Bf(x){return"\\"+F[x]}function Gf(x,N){return x==null?r:x[N]}function Xi(x){return bn.test(x)}function Wf(x){return Ci.test(x)}function Jf(x){for(var N,A=[];!(N=x.next()).done;)A.push(N.value);return A}function oo(x){var N=-1,A=Array(x.size);return x.forEach(function(W,ue){A[++N]=[ue,W]}),A}function eu(x,N){return function(A){return x(N(A))}}function li(x,N){for(var A=-1,W=x.length,ue=0,Re=[];++A<W;){var At=x[A];(At===N||At===_)&&(x[A]=_,Re[ue++]=A)}return Re}function Pn(x){var N=-1,A=Array(x.size);return x.forEach(function(W){A[++N]=W}),A}function Qf(x){var N=-1,A=Array(x.size);return x.forEach(function(W){A[++N]=[W,W]}),A}function Yf(x,N,A){for(var W=A-1,ue=x.length;++W<ue;)if(x[W]===N)return W;return-1}function Zf(x,N,A){for(var W=A+1;W--;)if(x[W]===N)return W;return W}function es(x){return Xi(x)?ep(x):jf(x)}function Cr(x){return Xi(x)?tp(x):zf(x)}function tu(x){for(var N=x.length;N--&&ft.test(x.charAt(N)););return N}var Xf=io(j);function ep(x){for(var N=Yi.lastIndex=0;Yi.test(x);)++N;return N}function tp(x){return x.match(Yi)||[]}function rp(x){return x.match(_n)||[]}var ip=function x(N){N=N==null?Ee:ts.defaults(Ee.Object(),N,ts.pick(Ee,En));var A=N.Array,W=N.Date,ue=N.Error,Re=N.Function,At=N.Math,Ue=N.Object,co=N.RegExp,sp=N.String,wr=N.TypeError,Sn=A.prototype,np=Re.prototype,rs=Ue.prototype,On=N["__core-js_shared__"],Rn=np.toString,$e=rs.hasOwnProperty,ap=0,ru=function(){var e=/[^.]+$/.exec(On&&On.keys&&On.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),An=rs.toString,op=Rn.call(Ue),cp=Ee._,up=co("^"+Rn.call($e).replace(ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Cn=Xt?N.Buffer:r,fi=N.Symbol,Tn=N.Uint8Array,iu=Cn?Cn.allocUnsafe:r,$n=eu(Ue.getPrototypeOf,Ue),su=Ue.create,nu=rs.propertyIsEnumerable,Nn=Sn.splice,au=fi?fi.isConcatSpreadable:r,xs=fi?fi.iterator:r,$i=fi?fi.toStringTag:r,Dn=function(){try{var e=ji(Ue,"defineProperty");return e({},"",{}),e}catch{}}(),hp=N.clearTimeout!==Ee.clearTimeout&&N.clearTimeout,lp=W&&W.now!==Ee.Date.now&&W.now,fp=N.setTimeout!==Ee.setTimeout&&N.setTimeout,qn=At.ceil,Ln=At.floor,uo=Ue.getOwnPropertySymbols,pp=Cn?Cn.isBuffer:r,ou=N.isFinite,dp=Sn.join,gp=eu(Ue.keys,Ue),Ct=At.max,Ut=At.min,yp=W.now,vp=N.parseInt,cu=At.random,mp=Sn.reverse,ho=ji(N,"DataView"),Ps=ji(N,"Map"),lo=ji(N,"Promise"),is=ji(N,"Set"),Ss=ji(N,"WeakMap"),Os=ji(Ue,"create"),jn=Ss&&new Ss,ss={},wp=zi(ho),_p=zi(Ps),bp=zi(lo),Ep=zi(is),Ip=zi(Ss),zn=fi?fi.prototype:r,Rs=zn?zn.valueOf:r,uu=zn?zn.toString:r;function p(e){if(ht(e)&&!le(e)&&!(e instanceof be)){if(e instanceof _r)return e;if($e.call(e,"__wrapped__"))return hh(e)}return new _r(e)}var ns=function(){function e(){}return function(i){if(!tt(i))return{};if(su)return su(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function Mn(){}function _r(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:nt,evaluate:at,interpolate:et,variable:"",imports:{_:p}},p.prototype=Mn.prototype,p.prototype.constructor=p,_r.prototype=ns(Mn.prototype),_r.prototype.constructor=_r;function be(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function xp(){var e=new be(this.__wrapped__);return e.__actions__=er(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=er(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=er(this.__views__),e}function Pp(){if(this.__filtered__){var e=new be(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Sp(){var e=this.__wrapped__.value(),i=this.__dir__,n=le(e),c=i<0,l=n?e.length:0,d=zd(0,l,this.__views__),w=d.start,b=d.end,P=b-w,q=c?b:w-1,L=this.__iteratees__,z=L.length,k=0,Y=Ut(P,this.__takeCount__);if(!n||!c&&l==P&&Y==P)return Nu(e,this.__actions__);var re=[];e:for(;P--&&k<Y;){q+=i;for(var ye=-1,ie=e[q];++ye<z;){var me=L[ye],Ie=me.iteratee,dr=me.type,Qt=Ie(ie);if(dr==U)ie=Qt;else if(!Qt){if(dr==M)continue e;break e}}re[k++]=ie}return re}be.prototype=ns(Mn.prototype),be.prototype.constructor=be;function Ni(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Op(){this.__data__=Os?Os(null):{},this.size=0}function Rp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Ap(e){var i=this.__data__;if(Os){var n=i[e];return n===m?r:n}return $e.call(i,e)?i[e]:r}function Cp(e){var i=this.__data__;return Os?i[e]!==r:$e.call(i,e)}function Tp(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Os&&i===r?m:i,this}Ni.prototype.clear=Op,Ni.prototype.delete=Rp,Ni.prototype.get=Ap,Ni.prototype.has=Cp,Ni.prototype.set=Tp;function Wr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function $p(){this.__data__=[],this.size=0}function Np(e){var i=this.__data__,n=Un(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():Nn.call(i,n,1),--this.size,!0}function Dp(e){var i=this.__data__,n=Un(i,e);return n<0?r:i[n][1]}function qp(e){return Un(this.__data__,e)>-1}function Lp(e,i){var n=this.__data__,c=Un(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}Wr.prototype.clear=$p,Wr.prototype.delete=Np,Wr.prototype.get=Dp,Wr.prototype.has=qp,Wr.prototype.set=Lp;function Jr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function jp(){this.size=0,this.__data__={hash:new Ni,map:new(Ps||Wr),string:new Ni}}function zp(e){var i=Zn(this,e).delete(e);return this.size-=i?1:0,i}function Mp(e){return Zn(this,e).get(e)}function Up(e){return Zn(this,e).has(e)}function Hp(e,i){var n=Zn(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}Jr.prototype.clear=jp,Jr.prototype.delete=zp,Jr.prototype.get=Mp,Jr.prototype.has=Up,Jr.prototype.set=Hp;function Di(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new Jr;++i<n;)this.add(e[i])}function kp(e){return this.__data__.set(e,m),this}function Kp(e){return this.__data__.has(e)}Di.prototype.add=Di.prototype.push=kp,Di.prototype.has=Kp;function Tr(e){var i=this.__data__=new Wr(e);this.size=i.size}function Vp(){this.__data__=new Wr,this.size=0}function Fp(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function Bp(e){return this.__data__.get(e)}function Gp(e){return this.__data__.has(e)}function Wp(e,i){var n=this.__data__;if(n instanceof Wr){var c=n.__data__;if(!Ps||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new Jr(c)}return n.set(e,i),this.size=n.size,this}Tr.prototype.clear=Vp,Tr.prototype.delete=Fp,Tr.prototype.get=Bp,Tr.prototype.has=Gp,Tr.prototype.set=Wp;function hu(e,i){var n=le(e),c=!n&&Mi(e),l=!n&&!c&&vi(e),d=!n&&!c&&!l&&us(e),w=n||c||l||d,b=w?no(e.length,sp):[],P=b.length;for(var q in e)(i||$e.call(e,q))&&!(w&&(q=="length"||l&&(q=="offset"||q=="parent")||d&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||Xr(q,P)))&&b.push(q);return b}function lu(e){var i=e.length;return i?e[Io(0,i-1)]:r}function Jp(e,i){return Xn(er(e),qi(i,0,e.length))}function Qp(e){return Xn(er(e))}function fo(e,i,n){(n!==r&&!$r(e[i],n)||n===r&&!(i in e))&&Qr(e,i,n)}function As(e,i,n){var c=e[i];(!($e.call(e,i)&&$r(c,n))||n===r&&!(i in e))&&Qr(e,i,n)}function Un(e,i){for(var n=e.length;n--;)if($r(e[n][0],i))return n;return-1}function Yp(e,i,n,c){return pi(e,function(l,d,w){i(c,l,n(l),w)}),c}function fu(e,i){return e&&Hr(i,Dt(i),e)}function Zp(e,i){return e&&Hr(i,rr(i),e)}function Qr(e,i,n){i=="__proto__"&&Dn?Dn(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function po(e,i){for(var n=-1,c=i.length,l=A(c),d=e==null;++n<c;)l[n]=d?r:Wo(e,i[n]);return l}function qi(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function br(e,i,n,c,l,d){var w,b=i&S,P=i&R,q=i&D;if(n&&(w=l?n(e,c,l,d):n(e)),w!==r)return w;if(!tt(e))return e;var L=le(e);if(L){if(w=Ud(e),!b)return er(e,w)}else{var z=Ht(e),k=z==J||z==oe;if(vi(e))return Lu(e,b);if(z==_e||z==we||k&&!l){if(w=P||k?{}:th(e),!b)return P?Ad(e,Zp(w,e)):Rd(e,fu(w,e))}else{if(!De[z])return l?e:{};w=Hd(e,z,b)}}d||(d=new Tr);var Y=d.get(e);if(Y)return Y;d.set(e,w),Ch(e)?e.forEach(function(ie){w.add(br(ie,i,n,ie,e,d))}):Rh(e)&&e.forEach(function(ie,me){w.set(me,br(ie,i,n,me,e,d))});var re=q?P?Do:No:P?rr:Dt,ye=L?r:re(e);return mr(ye||e,function(ie,me){ye&&(me=ie,ie=e[me]),As(w,me,br(ie,i,n,me,e,d))}),w}function Xp(e){var i=Dt(e);return function(n){return pu(n,e,i)}}function pu(e,i,n){var c=n.length;if(e==null)return!c;for(e=Ue(e);c--;){var l=n[c],d=i[l],w=e[l];if(w===r&&!(l in e)||!d(w))return!1}return!0}function du(e,i,n){if(typeof e!="function")throw new wr(f);return Ls(function(){e.apply(r,n)},i)}function Cs(e,i,n,c){var l=-1,d=In,w=!0,b=e.length,P=[],q=i.length;if(!b)return P;n&&(i=Qe(i,lr(n))),c?(d=Xa,w=!1):i.length>=a&&(d=Is,w=!1,i=new Di(i));e:for(;++l<b;){var L=e[l],z=n==null?L:n(L);if(L=c||L!==0?L:0,w&&z===z){for(var k=q;k--;)if(i[k]===z)continue e;P.push(L)}else d(i,z,c)||P.push(L)}return P}var pi=Hu(Ur),gu=Hu(yo,!0);function ed(e,i){var n=!0;return pi(e,function(c,l,d){return n=!!i(c,l,d),n}),n}function Hn(e,i,n){for(var c=-1,l=e.length;++c<l;){var d=e[c],w=i(d);if(w!=null&&(b===r?w===w&&!pr(w):n(w,b)))var b=w,P=d}return P}function td(e,i,n,c){var l=e.length;for(n=de(n),n<0&&(n=-n>l?0:l+n),c=c===r||c>l?l:de(c),c<0&&(c+=l),c=n>c?0:$h(c);n<c;)e[n++]=i;return e}function yu(e,i){var n=[];return pi(e,function(c,l,d){i(c,l,d)&&n.push(c)}),n}function zt(e,i,n,c,l){var d=-1,w=e.length;for(n||(n=Kd),l||(l=[]);++d<w;){var b=e[d];i>0&&n(b)?i>1?zt(b,i-1,n,c,l):hi(l,b):c||(l[l.length]=b)}return l}var go=ku(),vu=ku(!0);function Ur(e,i){return e&&go(e,i,Dt)}function yo(e,i){return e&&vu(e,i,Dt)}function kn(e,i){return ui(i,function(n){return ei(e[n])})}function Li(e,i){i=gi(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[kr(i[n++])];return n&&n==c?e:r}function mu(e,i,n){var c=i(e);return le(e)?c:hi(c,n(e))}function Wt(e){return e==null?e===r?Xe:Oe:$i&&$i in Ue(e)?jd(e):Qd(e)}function vo(e,i){return e>i}function rd(e,i){return e!=null&&$e.call(e,i)}function id(e,i){return e!=null&&i in Ue(e)}function sd(e,i,n){return e>=Ut(i,n)&&e<Ct(i,n)}function mo(e,i,n){for(var c=n?Xa:In,l=e[0].length,d=e.length,w=d,b=A(d),P=1/0,q=[];w--;){var L=e[w];w&&i&&(L=Qe(L,lr(i))),P=Ut(L.length,P),b[w]=!n&&(i||l>=120&&L.length>=120)?new Di(w&&L):r}L=e[0];var z=-1,k=b[0];e:for(;++z<l&&q.length<P;){var Y=L[z],re=i?i(Y):Y;if(Y=n||Y!==0?Y:0,!(k?Is(k,re):c(q,re,n))){for(w=d;--w;){var ye=b[w];if(!(ye?Is(ye,re):c(e[w],re,n)))continue e}k&&k.push(re),q.push(Y)}}return q}function nd(e,i,n,c){return Ur(e,function(l,d,w){i(c,n(l),d,w)}),c}function Ts(e,i,n){i=gi(i,e),e=nh(e,i);var c=e==null?e:e[kr(Ir(i))];return c==null?r:Nt(c,e,n)}function wu(e){return ht(e)&&Wt(e)==we}function ad(e){return ht(e)&&Wt(e)==Se}function od(e){return ht(e)&&Wt(e)==O}function $s(e,i,n,c,l){return e===i?!0:e==null||i==null||!ht(e)&&!ht(i)?e!==e&&i!==i:cd(e,i,n,c,$s,l)}function cd(e,i,n,c,l,d){var w=le(e),b=le(i),P=w?Or:Ht(e),q=b?Or:Ht(i);P=P==we?_e:P,q=q==we?_e:q;var L=P==_e,z=q==_e,k=P==q;if(k&&vi(e)){if(!vi(i))return!1;w=!0,L=!1}if(k&&!L)return d||(d=new Tr),w||us(e)?Zu(e,i,n,c,l,d):qd(e,i,P,n,c,l,d);if(!(n&C)){var Y=L&&$e.call(e,"__wrapped__"),re=z&&$e.call(i,"__wrapped__");if(Y||re){var ye=Y?e.value():e,ie=re?i.value():i;return d||(d=new Tr),l(ye,ie,n,c,d)}}return k?(d||(d=new Tr),Ld(e,i,n,c,l,d)):!1}function ud(e){return ht(e)&&Ht(e)==ge}function wo(e,i,n,c){var l=n.length,d=l,w=!c;if(e==null)return!d;for(e=Ue(e);l--;){var b=n[l];if(w&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++l<d;){b=n[l];var P=b[0],q=e[P],L=b[1];if(w&&b[2]){if(q===r&&!(P in e))return!1}else{var z=new Tr;if(c)var k=c(q,L,P,e,i,z);if(!(k===r?$s(L,q,C|Z,c,z):k))return!1}}return!0}function _u(e){if(!tt(e)||Fd(e))return!1;var i=ei(e)?up:ja;return i.test(zi(e))}function hd(e){return ht(e)&&Wt(e)==Ze}function ld(e){return ht(e)&&Ht(e)==Ae}function fd(e){return ht(e)&&na(e.length)&&!!je[Wt(e)]}function bu(e){return typeof e=="function"?e:e==null?ir:typeof e=="object"?le(e)?xu(e[0],e[1]):Iu(e):Kh(e)}function _o(e){if(!qs(e))return gp(e);var i=[];for(var n in Ue(e))$e.call(e,n)&&n!="constructor"&&i.push(n);return i}function pd(e){if(!tt(e))return Jd(e);var i=qs(e),n=[];for(var c in e)c=="constructor"&&(i||!$e.call(e,c))||n.push(c);return n}function bo(e,i){return e<i}function Eu(e,i){var n=-1,c=tr(e)?A(e.length):[];return pi(e,function(l,d,w){c[++n]=i(l,d,w)}),c}function Iu(e){var i=Lo(e);return i.length==1&&i[0][2]?ih(i[0][0],i[0][1]):function(n){return n===e||wo(n,e,i)}}function xu(e,i){return zo(e)&&rh(i)?ih(kr(e),i):function(n){var c=Wo(n,e);return c===r&&c===i?Jo(n,e):$s(i,c,C|Z)}}function Kn(e,i,n,c,l){e!==i&&go(i,function(d,w){if(l||(l=new Tr),tt(d))dd(e,i,w,n,Kn,c,l);else{var b=c?c(Uo(e,w),d,w+"",e,i,l):r;b===r&&(b=d),fo(e,w,b)}},rr)}function dd(e,i,n,c,l,d,w){var b=Uo(e,n),P=Uo(i,n),q=w.get(P);if(q){fo(e,n,q);return}var L=d?d(b,P,n+"",e,i,w):r,z=L===r;if(z){var k=le(P),Y=!k&&vi(P),re=!k&&!Y&&us(P);L=P,k||Y||re?le(b)?L=b:dt(b)?L=er(b):Y?(z=!1,L=Lu(P,!0)):re?(z=!1,L=ju(P,!0)):L=[]:js(P)||Mi(P)?(L=b,Mi(b)?L=Nh(b):(!tt(b)||ei(b))&&(L=th(P))):z=!1}z&&(w.set(P,L),l(L,P,c,d,w),w.delete(P)),fo(e,n,L)}function Pu(e,i){var n=e.length;if(n)return i+=i<0?n:0,Xr(i,n)?e[i]:r}function Su(e,i,n){i.length?i=Qe(i,function(d){return le(d)?function(w){return Li(w,d.length===1?d[0]:d)}:d}):i=[ir];var c=-1;i=Qe(i,lr(ee()));var l=Eu(e,function(d,w,b){var P=Qe(i,function(q){return q(d)});return{criteria:P,index:++c,value:d}});return Hf(l,function(d,w){return Od(d,w,n)})}function gd(e,i){return Ou(e,i,function(n,c){return Jo(e,c)})}function Ou(e,i,n){for(var c=-1,l=i.length,d={};++c<l;){var w=i[c],b=Li(e,w);n(b,w)&&Ns(d,gi(w,e),b)}return d}function yd(e){return function(i){return Li(i,e)}}function Eo(e,i,n,c){var l=c?Uf:Zi,d=-1,w=i.length,b=e;for(e===i&&(i=er(i)),n&&(b=Qe(e,lr(n)));++d<w;)for(var P=0,q=i[d],L=n?n(q):q;(P=l(b,L,P,c))>-1;)b!==e&&Nn.call(b,P,1),Nn.call(e,P,1);return e}function Ru(e,i){for(var n=e?i.length:0,c=n-1;n--;){var l=i[n];if(n==c||l!==d){var d=l;Xr(l)?Nn.call(e,l,1):So(e,l)}}return e}function Io(e,i){return e+Ln(cu()*(i-e+1))}function vd(e,i,n,c){for(var l=-1,d=Ct(qn((i-e)/(n||1)),0),w=A(d);d--;)w[c?d:++l]=e,e+=n;return w}function xo(e,i){var n="";if(!e||i<1||i>G)return n;do i%2&&(n+=e),i=Ln(i/2),i&&(e+=e);while(i);return n}function ve(e,i){return Ho(sh(e,i,ir),e+"")}function md(e){return lu(hs(e))}function wd(e,i){var n=hs(e);return Xn(n,qi(i,0,n.length))}function Ns(e,i,n,c){if(!tt(e))return e;i=gi(i,e);for(var l=-1,d=i.length,w=d-1,b=e;b!=null&&++l<d;){var P=kr(i[l]),q=n;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=w){var L=b[P];q=c?c(L,P,b):r,q===r&&(q=tt(L)?L:Xr(i[l+1])?[]:{})}As(b,P,q),b=b[P]}return e}var Au=jn?function(e,i){return jn.set(e,i),e}:ir,_d=Dn?function(e,i){return Dn(e,"toString",{configurable:!0,enumerable:!1,value:Yo(i),writable:!0})}:ir;function bd(e){return Xn(hs(e))}function Er(e,i,n){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),n=n>l?l:n,n<0&&(n+=l),l=i>n?0:n-i>>>0,i>>>=0;for(var d=A(l);++c<l;)d[c]=e[c+i];return d}function Ed(e,i){var n;return pi(e,function(c,l,d){return n=i(c,l,d),!n}),!!n}function Vn(e,i,n){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=rt){for(;c<l;){var d=c+l>>>1,w=e[d];w!==null&&!pr(w)&&(n?w<=i:w<i)?c=d+1:l=d}return l}return Po(e,i,ir,n)}function Po(e,i,n,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;i=n(i);for(var w=i!==i,b=i===null,P=pr(i),q=i===r;l<d;){var L=Ln((l+d)/2),z=n(e[L]),k=z!==r,Y=z===null,re=z===z,ye=pr(z);if(w)var ie=c||re;else q?ie=re&&(c||k):b?ie=re&&k&&(c||!Y):P?ie=re&&k&&!Y&&(c||!ye):Y||ye?ie=!1:ie=c?z<=i:z<i;ie?l=L+1:d=L}return Ut(d,Ot)}function Cu(e,i){for(var n=-1,c=e.length,l=0,d=[];++n<c;){var w=e[n],b=i?i(w):w;if(!n||!$r(b,P)){var P=b;d[l++]=w===0?0:w}}return d}function Tu(e){return typeof e=="number"?e:pr(e)?H:+e}function fr(e){if(typeof e=="string")return e;if(le(e))return Qe(e,fr)+"";if(pr(e))return uu?uu.call(e):"";var i=e+"";return i=="0"&&1/e==-qe?"-0":i}function di(e,i,n){var c=-1,l=In,d=e.length,w=!0,b=[],P=b;if(n)w=!1,l=Xa;else if(d>=a){var q=i?null:Nd(e);if(q)return Pn(q);w=!1,l=Is,P=new Di}else P=i?[]:b;e:for(;++c<d;){var L=e[c],z=i?i(L):L;if(L=n||L!==0?L:0,w&&z===z){for(var k=P.length;k--;)if(P[k]===z)continue e;i&&P.push(z),b.push(L)}else l(P,z,n)||(P!==b&&P.push(z),b.push(L))}return b}function So(e,i){return i=gi(i,e),e=nh(e,i),e==null||delete e[kr(Ir(i))]}function $u(e,i,n,c){return Ns(e,i,n(Li(e,i)),c)}function Fn(e,i,n,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&i(e[d],d,e););return n?Er(e,c?0:d,c?d+1:l):Er(e,c?d+1:0,c?l:d)}function Nu(e,i){var n=e;return n instanceof be&&(n=n.value()),eo(i,function(c,l){return l.func.apply(l.thisArg,hi([c],l.args))},n)}function Oo(e,i,n){var c=e.length;if(c<2)return c?di(e[0]):[];for(var l=-1,d=A(c);++l<c;)for(var w=e[l],b=-1;++b<c;)b!=l&&(d[l]=Cs(d[l]||w,e[b],i,n));return di(zt(d,1),i,n)}function Du(e,i,n){for(var c=-1,l=e.length,d=i.length,w={};++c<l;){var b=c<d?i[c]:r;n(w,e[c],b)}return w}function Ro(e){return dt(e)?e:[]}function Ao(e){return typeof e=="function"?e:ir}function gi(e,i){return le(e)?e:zo(e,i)?[e]:uh(Ce(e))}var Id=ve;function yi(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:Er(e,i,n)}var qu=hp||function(e){return Ee.clearTimeout(e)};function Lu(e,i){if(i)return e.slice();var n=e.length,c=iu?iu(n):new e.constructor(n);return e.copy(c),c}function Co(e){var i=new e.constructor(e.byteLength);return new Tn(i).set(new Tn(e)),i}function xd(e,i){var n=i?Co(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Pd(e){var i=new e.constructor(e.source,yr.exec(e));return i.lastIndex=e.lastIndex,i}function Sd(e){return Rs?Ue(Rs.call(e)):{}}function ju(e,i){var n=i?Co(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function zu(e,i){if(e!==i){var n=e!==r,c=e===null,l=e===e,d=pr(e),w=i!==r,b=i===null,P=i===i,q=pr(i);if(!b&&!q&&!d&&e>i||d&&w&&P&&!b&&!q||c&&w&&P||!n&&P||!l)return 1;if(!c&&!d&&!q&&e<i||q&&n&&l&&!c&&!d||b&&n&&l||!w&&l||!P)return-1}return 0}function Od(e,i,n){for(var c=-1,l=e.criteria,d=i.criteria,w=l.length,b=n.length;++c<w;){var P=zu(l[c],d[c]);if(P){if(c>=b)return P;var q=n[c];return P*(q=="desc"?-1:1)}}return e.index-i.index}function Mu(e,i,n,c){for(var l=-1,d=e.length,w=n.length,b=-1,P=i.length,q=Ct(d-w,0),L=A(P+q),z=!c;++b<P;)L[b]=i[b];for(;++l<w;)(z||l<d)&&(L[n[l]]=e[l]);for(;q--;)L[b++]=e[l++];return L}function Uu(e,i,n,c){for(var l=-1,d=e.length,w=-1,b=n.length,P=-1,q=i.length,L=Ct(d-b,0),z=A(L+q),k=!c;++l<L;)z[l]=e[l];for(var Y=l;++P<q;)z[Y+P]=i[P];for(;++w<b;)(k||l<d)&&(z[Y+n[w]]=e[l++]);return z}function er(e,i){var n=-1,c=e.length;for(i||(i=A(c));++n<c;)i[n]=e[n];return i}function Hr(e,i,n,c){var l=!n;n||(n={});for(var d=-1,w=i.length;++d<w;){var b=i[d],P=c?c(n[b],e[b],b,n,e):r;P===r&&(P=e[b]),l?Qr(n,b,P):As(n,b,P)}return n}function Rd(e,i){return Hr(e,jo(e),i)}function Ad(e,i){return Hr(e,Xu(e),i)}function Bn(e,i){return function(n,c){var l=le(n)?Df:Yp,d=i?i():{};return l(n,e,ee(c,2),d)}}function as(e){return ve(function(i,n){var c=-1,l=n.length,d=l>1?n[l-1]:r,w=l>2?n[2]:r;for(d=e.length>3&&typeof d=="function"?(l--,d):r,w&&Jt(n[0],n[1],w)&&(d=l<3?r:d,l=1),i=Ue(i);++c<l;){var b=n[c];b&&e(i,b,c,d)}return i})}function Hu(e,i){return function(n,c){if(n==null)return n;if(!tr(n))return e(n,c);for(var l=n.length,d=i?l:-1,w=Ue(n);(i?d--:++d<l)&&c(w[d],d,w)!==!1;);return n}}function ku(e){return function(i,n,c){for(var l=-1,d=Ue(i),w=c(i),b=w.length;b--;){var P=w[e?b:++l];if(n(d[P],P,d)===!1)break}return i}}function Cd(e,i,n){var c=i&se,l=Ds(e);function d(){var w=this&&this!==Ee&&this instanceof d?l:e;return w.apply(c?n:this,arguments)}return d}function Ku(e){return function(i){i=Ce(i);var n=Xi(i)?Cr(i):r,c=n?n[0]:i.charAt(0),l=n?yi(n,1).join(""):i.slice(1);return c[e]()+l}}function os(e){return function(i){return eo(Hh(Uh(i).replace(bs,"")),e,"")}}function Ds(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=ns(e.prototype),c=e.apply(n,i);return tt(c)?c:n}}function Td(e,i,n){var c=Ds(e);function l(){for(var d=arguments.length,w=A(d),b=d,P=cs(l);b--;)w[b]=arguments[b];var q=d<3&&w[0]!==P&&w[d-1]!==P?[]:li(w,P);if(d-=q.length,d<n)return Wu(e,i,Gn,l.placeholder,r,w,q,r,r,n-d);var L=this&&this!==Ee&&this instanceof l?c:e;return Nt(L,this,w)}return l}function Vu(e){return function(i,n,c){var l=Ue(i);if(!tr(i)){var d=ee(n,3);i=Dt(i),n=function(b){return d(l[b],b,l)}}var w=e(i,n,c);return w>-1?l[d?i[w]:w]:r}}function Fu(e){return Zr(function(i){var n=i.length,c=n,l=_r.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new wr(f);if(l&&!w&&Yn(d)=="wrapper")var w=new _r([],!0)}for(c=w?c:n;++c<n;){d=i[c];var b=Yn(d),P=b=="wrapper"?qo(d):r;P&&Mo(P[0])&&P[1]==(Q|ae|fe|xe)&&!P[4].length&&P[9]==1?w=w[Yn(P[0])].apply(w,P[3]):w=d.length==1&&Mo(d)?w[b]():w.thru(d)}return function(){var q=arguments,L=q[0];if(w&&q.length==1&&le(L))return w.plant(L).value();for(var z=0,k=n?i[z].apply(this,q):L;++z<n;)k=i[z].call(this,k);return k}})}function Gn(e,i,n,c,l,d,w,b,P,q){var L=i&Q,z=i&se,k=i&ne,Y=i&(ae|te),re=i&Tt,ye=k?r:Ds(e);function ie(){for(var me=arguments.length,Ie=A(me),dr=me;dr--;)Ie[dr]=arguments[dr];if(Y)var Qt=cs(ie),gr=Kf(Ie,Qt);if(c&&(Ie=Mu(Ie,c,l,Y)),d&&(Ie=Uu(Ie,d,w,Y)),me-=gr,Y&&me<q){var gt=li(Ie,Qt);return Wu(e,i,Gn,ie.placeholder,n,Ie,gt,b,P,q-me)}var Nr=z?n:this,ri=k?Nr[e]:e;return me=Ie.length,b?Ie=Yd(Ie,b):re&&me>1&&Ie.reverse(),L&&P<me&&(Ie.length=P),this&&this!==Ee&&this instanceof ie&&(ri=ye||Ds(ri)),ri.apply(Nr,Ie)}return ie}function Bu(e,i){return function(n,c){return nd(n,e,i(c),{})}}function Wn(e,i){return function(n,c){var l;if(n===r&&c===r)return i;if(n!==r&&(l=n),c!==r){if(l===r)return c;typeof n=="string"||typeof c=="string"?(n=fr(n),c=fr(c)):(n=Tu(n),c=Tu(c)),l=e(n,c)}return l}}function To(e){return Zr(function(i){return i=Qe(i,lr(ee())),ve(function(n){var c=this;return e(i,function(l){return Nt(l,c,n)})})})}function Jn(e,i){i=i===r?" ":fr(i);var n=i.length;if(n<2)return n?xo(i,e):i;var c=xo(i,qn(e/es(i)));return Xi(i)?yi(Cr(c),0,e).join(""):c.slice(0,e)}function $d(e,i,n,c){var l=i&se,d=Ds(e);function w(){for(var b=-1,P=arguments.length,q=-1,L=c.length,z=A(L+P),k=this&&this!==Ee&&this instanceof w?d:e;++q<L;)z[q]=c[q];for(;P--;)z[q++]=arguments[++b];return Nt(k,l?n:this,z)}return w}function Gu(e){return function(i,n,c){return c&&typeof c!="number"&&Jt(i,n,c)&&(n=c=r),i=ti(i),n===r?(n=i,i=0):n=ti(n),c=c===r?i<n?1:-1:ti(c),vd(i,n,c,e)}}function Qn(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=xr(i),n=xr(n)),e(i,n)}}function Wu(e,i,n,c,l,d,w,b,P,q){var L=i&ae,z=L?w:r,k=L?r:w,Y=L?d:r,re=L?r:d;i|=L?fe:pe,i&=~(L?pe:fe),i&ce||(i&=~(se|ne));var ye=[e,i,l,Y,z,re,k,b,P,q],ie=n.apply(r,ye);return Mo(e)&&ah(ie,ye),ie.placeholder=c,oh(ie,e,i)}function $o(e){var i=At[e];return function(n,c){if(n=xr(n),c=c==null?0:Ut(de(c),292),c&&ou(n)){var l=(Ce(n)+"e").split("e"),d=i(l[0]+"e"+(+l[1]+c));return l=(Ce(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(n)}}var Nd=is&&1/Pn(new is([,-0]))[1]==qe?function(e){return new is(e)}:ec;function Ju(e){return function(i){var n=Ht(i);return n==ge?oo(i):n==Ae?Qf(i):kf(i,e(i))}}function Yr(e,i,n,c,l,d,w,b){var P=i&ne;if(!P&&typeof e!="function")throw new wr(f);var q=c?c.length:0;if(q||(i&=~(fe|pe),c=l=r),w=w===r?w:Ct(de(w),0),b=b===r?b:de(b),q-=l?l.length:0,i&pe){var L=c,z=l;c=l=r}var k=P?r:qo(e),Y=[e,i,n,c,l,L,z,d,w,b];if(k&&Wd(Y,k),e=Y[0],i=Y[1],n=Y[2],c=Y[3],l=Y[4],b=Y[9]=Y[9]===r?P?0:e.length:Ct(Y[9]-q,0),!b&&i&(ae|te)&&(i&=~(ae|te)),!i||i==se)var re=Cd(e,i,n);else i==ae||i==te?re=Td(e,i,b):(i==fe||i==(se|fe))&&!l.length?re=$d(e,i,n,c):re=Gn.apply(r,Y);var ye=k?Au:ah;return oh(ye(re,Y),e,i)}function Qu(e,i,n,c){return e===r||$r(e,rs[n])&&!$e.call(c,n)?i:e}function Yu(e,i,n,c,l,d){return tt(e)&&tt(i)&&(d.set(i,e),Kn(e,i,r,Yu,d),d.delete(i)),e}function Dd(e){return js(e)?r:e}function Zu(e,i,n,c,l,d){var w=n&C,b=e.length,P=i.length;if(b!=P&&!(w&&P>b))return!1;var q=d.get(e),L=d.get(i);if(q&&L)return q==i&&L==e;var z=-1,k=!0,Y=n&Z?new Di:r;for(d.set(e,i),d.set(i,e);++z<b;){var re=e[z],ye=i[z];if(c)var ie=w?c(ye,re,z,i,e,d):c(re,ye,z,e,i,d);if(ie!==r){if(ie)continue;k=!1;break}if(Y){if(!to(i,function(me,Ie){if(!Is(Y,Ie)&&(re===me||l(re,me,n,c,d)))return Y.push(Ie)})){k=!1;break}}else if(!(re===ye||l(re,ye,n,c,d))){k=!1;break}}return d.delete(e),d.delete(i),k}function qd(e,i,n,c,l,d,w){switch(n){case Le:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Se:return!(e.byteLength!=i.byteLength||!d(new Tn(e),new Tn(i)));case T:case O:case Pe:return $r(+e,+i);case E:return e.name==i.name&&e.message==i.message;case Ze:case ke:return e==i+"";case ge:var b=oo;case Ae:var P=c&C;if(b||(b=Pn),e.size!=i.size&&!P)return!1;var q=w.get(e);if(q)return q==i;c|=Z,w.set(e,i);var L=Zu(b(e),b(i),c,l,d,w);return w.delete(e),L;case Ke:if(Rs)return Rs.call(e)==Rs.call(i)}return!1}function Ld(e,i,n,c,l,d){var w=n&C,b=No(e),P=b.length,q=No(i),L=q.length;if(P!=L&&!w)return!1;for(var z=P;z--;){var k=b[z];if(!(w?k in i:$e.call(i,k)))return!1}var Y=d.get(e),re=d.get(i);if(Y&&re)return Y==i&&re==e;var ye=!0;d.set(e,i),d.set(i,e);for(var ie=w;++z<P;){k=b[z];var me=e[k],Ie=i[k];if(c)var dr=w?c(Ie,me,k,i,e,d):c(me,Ie,k,e,i,d);if(!(dr===r?me===Ie||l(me,Ie,n,c,d):dr)){ye=!1;break}ie||(ie=k=="constructor")}if(ye&&!ie){var Qt=e.constructor,gr=i.constructor;Qt!=gr&&"constructor"in e&&"constructor"in i&&!(typeof Qt=="function"&&Qt instanceof Qt&&typeof gr=="function"&&gr instanceof gr)&&(ye=!1)}return d.delete(e),d.delete(i),ye}function Zr(e){return Ho(sh(e,r,ph),e+"")}function No(e){return mu(e,Dt,jo)}function Do(e){return mu(e,rr,Xu)}var qo=jn?function(e){return jn.get(e)}:ec;function Yn(e){for(var i=e.name+"",n=ss[i],c=$e.call(ss,i)?n.length:0;c--;){var l=n[c],d=l.func;if(d==null||d==e)return l.name}return i}function cs(e){var i=$e.call(p,"placeholder")?p:e;return i.placeholder}function ee(){var e=p.iteratee||Zo;return e=e===Zo?bu:e,arguments.length?e(arguments[0],arguments[1]):e}function Zn(e,i){var n=e.__data__;return Vd(i)?n[typeof i=="string"?"string":"hash"]:n.map}function Lo(e){for(var i=Dt(e),n=i.length;n--;){var c=i[n],l=e[c];i[n]=[c,l,rh(l)]}return i}function ji(e,i){var n=Gf(e,i);return _u(n)?n:r}function jd(e){var i=$e.call(e,$i),n=e[$i];try{e[$i]=r;var c=!0}catch{}var l=An.call(e);return c&&(i?e[$i]=n:delete e[$i]),l}var jo=uo?function(e){return e==null?[]:(e=Ue(e),ui(uo(e),function(i){return nu.call(e,i)}))}:tc,Xu=uo?function(e){for(var i=[];e;)hi(i,jo(e)),e=$n(e);return i}:tc,Ht=Wt;(ho&&Ht(new ho(new ArrayBuffer(1)))!=Le||Ps&&Ht(new Ps)!=ge||lo&&Ht(lo.resolve())!=vt||is&&Ht(new is)!=Ae||Ss&&Ht(new Ss)!=Ne)&&(Ht=function(e){var i=Wt(e),n=i==_e?e.constructor:r,c=n?zi(n):"";if(c)switch(c){case wp:return Le;case _p:return ge;case bp:return vt;case Ep:return Ae;case Ip:return Ne}return i});function zd(e,i,n){for(var c=-1,l=n.length;++c<l;){var d=n[c],w=d.size;switch(d.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Ut(i,e+w);break;case"takeRight":e=Ct(e,i-w);break}}return{start:e,end:i}}function Md(e){var i=e.match(He);return i?i[1].split(Et):[]}function eh(e,i,n){i=gi(i,e);for(var c=-1,l=i.length,d=!1;++c<l;){var w=kr(i[c]);if(!(d=e!=null&&n(e,w)))break;e=e[w]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&na(l)&&Xr(w,l)&&(le(e)||Mi(e)))}function Ud(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&$e.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function th(e){return typeof e.constructor=="function"&&!qs(e)?ns($n(e)):{}}function Hd(e,i,n){var c=e.constructor;switch(i){case Se:return Co(e);case T:case O:return new c(+e);case Le:return xd(e,n);case it:case Te:case mt:case Rt:case Lt:case jt:case $t:case Ft:case Zt:return ju(e,n);case ge:return new c;case Pe:case ke:return new c(e);case Ze:return Pd(e);case Ae:return new c;case Ke:return Sd(e)}}function kd(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(ut,`{
/* [wrapped with `+i+`] */
`)}function Kd(e){return le(e)||Mi(e)||!!(au&&e&&e[au])}function Xr(e,i){var n=typeof e;return i=i??G,!!i&&(n=="number"||n!="symbol"&&Ma.test(e))&&e>-1&&e%1==0&&e<i}function Jt(e,i,n){if(!tt(n))return!1;var c=typeof i;return(c=="number"?tr(n)&&Xr(i,n.length):c=="string"&&i in n)?$r(n[i],e):!1}function zo(e,i){if(le(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||pr(e)?!0:wt.test(e)||!Je.test(e)||i!=null&&e in Ue(i)}function Vd(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Mo(e){var i=Yn(e),n=p[i];if(typeof n!="function"||!(i in be.prototype))return!1;if(e===n)return!0;var c=qo(n);return!!c&&e===c[0]}function Fd(e){return!!ru&&ru in e}var Bd=On?ei:rc;function qs(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||rs;return e===n}function rh(e){return e===e&&!tt(e)}function ih(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in Ue(n))}}function Gd(e){var i=ia(e,function(c){return n.size===g&&n.clear(),c}),n=i.cache;return i}function Wd(e,i){var n=e[1],c=i[1],l=n|c,d=l<(se|ne|Q),w=c==Q&&n==ae||c==Q&&n==xe&&e[7].length<=i[8]||c==(Q|xe)&&i[7].length<=i[8]&&n==ae;if(!(d||w))return e;c&se&&(e[2]=i[2],l|=n&se?0:ce);var b=i[3];if(b){var P=e[3];e[3]=P?Mu(P,b,i[4]):b,e[4]=P?li(e[3],_):i[4]}return b=i[5],b&&(P=e[5],e[5]=P?Uu(P,b,i[6]):b,e[6]=P?li(e[5],_):i[6]),b=i[7],b&&(e[7]=b),c&Q&&(e[8]=e[8]==null?i[8]:Ut(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function Jd(e){var i=[];if(e!=null)for(var n in Ue(e))i.push(n);return i}function Qd(e){return An.call(e)}function sh(e,i,n){return i=Ct(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,d=Ct(c.length-i,0),w=A(d);++l<d;)w[l]=c[i+l];l=-1;for(var b=A(i+1);++l<i;)b[l]=c[l];return b[i]=n(w),Nt(e,this,b)}}function nh(e,i){return i.length<2?e:Li(e,Er(i,0,-1))}function Yd(e,i){for(var n=e.length,c=Ut(i.length,n),l=er(e);c--;){var d=i[c];e[c]=Xr(d,n)?l[d]:r}return e}function Uo(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var ah=ch(Au),Ls=fp||function(e,i){return Ee.setTimeout(e,i)},Ho=ch(_d);function oh(e,i,n){var c=i+"";return Ho(e,kd(c,Zd(Md(c),n)))}function ch(e){var i=0,n=0;return function(){var c=yp(),l=ur-(c-n);if(n=c,l>0){if(++i>=Vt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function Xn(e,i){var n=-1,c=e.length,l=c-1;for(i=i===r?c:i;++n<i;){var d=Io(n,l),w=e[d];e[d]=e[n],e[n]=w}return e.length=i,e}var uh=Gd(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(_t,function(n,c,l,d){i.push(l?d.replace(Na,"$1"):c||n)}),i});function kr(e){if(typeof e=="string"||pr(e))return e;var i=e+"";return i=="0"&&1/e==-qe?"-0":i}function zi(e){if(e!=null){try{return Rn.call(e)}catch{}try{return e+""}catch{}}return""}function Zd(e,i){return mr(Pi,function(n){var c="_."+n[0];i&n[1]&&!In(e,c)&&e.push(c)}),e.sort()}function hh(e){if(e instanceof be)return e.clone();var i=new _r(e.__wrapped__,e.__chain__);return i.__actions__=er(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Xd(e,i,n){(n?Jt(e,i,n):i===r)?i=1:i=Ct(de(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,d=0,w=A(qn(c/i));l<c;)w[d++]=Er(e,l,l+=i);return w}function eg(e){for(var i=-1,n=e==null?0:e.length,c=0,l=[];++i<n;){var d=e[i];d&&(l[c++]=d)}return l}function tg(){var e=arguments.length;if(!e)return[];for(var i=A(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return hi(le(n)?er(n):[n],zt(i,1))}var rg=ve(function(e,i){return dt(e)?Cs(e,zt(i,1,dt,!0)):[]}),ig=ve(function(e,i){var n=Ir(i);return dt(n)&&(n=r),dt(e)?Cs(e,zt(i,1,dt,!0),ee(n,2)):[]}),sg=ve(function(e,i){var n=Ir(i);return dt(n)&&(n=r),dt(e)?Cs(e,zt(i,1,dt,!0),r,n):[]});function ng(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),Er(e,i<0?0:i,c)):[]}function ag(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),i=c-i,Er(e,0,i<0?0:i)):[]}function og(e,i){return e&&e.length?Fn(e,ee(i,3),!0,!0):[]}function cg(e,i){return e&&e.length?Fn(e,ee(i,3),!0):[]}function ug(e,i,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Jt(e,i,n)&&(n=0,c=l),td(e,i,n,c)):[]}function lh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),xn(e,ee(i,3),l)}function fh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==r&&(l=de(n),l=n<0?Ct(c+l,0):Ut(l,c-1)),xn(e,ee(i,3),l,!0)}function ph(e){var i=e==null?0:e.length;return i?zt(e,1):[]}function hg(e){var i=e==null?0:e.length;return i?zt(e,qe):[]}function lg(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:de(i),zt(e,i)):[]}function fg(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var l=e[i];c[l[0]]=l[1]}return c}function dh(e){return e&&e.length?e[0]:r}function pg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),Zi(e,i,l)}function dg(e){var i=e==null?0:e.length;return i?Er(e,0,-1):[]}var gg=ve(function(e){var i=Qe(e,Ro);return i.length&&i[0]===e[0]?mo(i):[]}),yg=ve(function(e){var i=Ir(e),n=Qe(e,Ro);return i===Ir(n)?i=r:n.pop(),n.length&&n[0]===e[0]?mo(n,ee(i,2)):[]}),vg=ve(function(e){var i=Ir(e),n=Qe(e,Ro);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?mo(n,r,i):[]});function mg(e,i){return e==null?"":dp.call(e,i)}function Ir(e){var i=e==null?0:e.length;return i?e[i-1]:r}function wg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==r&&(l=de(n),l=l<0?Ct(c+l,0):Ut(l,c-1)),i===i?Zf(e,i,l):xn(e,Wc,l,!0)}function _g(e,i){return e&&e.length?Pu(e,de(i)):r}var bg=ve(gh);function gh(e,i){return e&&e.length&&i&&i.length?Eo(e,i):e}function Eg(e,i,n){return e&&e.length&&i&&i.length?Eo(e,i,ee(n,2)):e}function Ig(e,i,n){return e&&e.length&&i&&i.length?Eo(e,i,r,n):e}var xg=Zr(function(e,i){var n=e==null?0:e.length,c=po(e,i);return Ru(e,Qe(i,function(l){return Xr(l,n)?+l:l}).sort(zu)),c});function Pg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],d=e.length;for(i=ee(i,3);++c<d;){var w=e[c];i(w,c,e)&&(n.push(w),l.push(c))}return Ru(e,l),n}function ko(e){return e==null?e:mp.call(e)}function Sg(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Jt(e,i,n)?(i=0,n=c):(i=i==null?0:de(i),n=n===r?c:de(n)),Er(e,i,n)):[]}function Og(e,i){return Vn(e,i)}function Rg(e,i,n){return Po(e,i,ee(n,2))}function Ag(e,i){var n=e==null?0:e.length;if(n){var c=Vn(e,i);if(c<n&&$r(e[c],i))return c}return-1}function Cg(e,i){return Vn(e,i,!0)}function Tg(e,i,n){return Po(e,i,ee(n,2),!0)}function $g(e,i){var n=e==null?0:e.length;if(n){var c=Vn(e,i,!0)-1;if($r(e[c],i))return c}return-1}function Ng(e){return e&&e.length?Cu(e):[]}function Dg(e,i){return e&&e.length?Cu(e,ee(i,2)):[]}function qg(e){var i=e==null?0:e.length;return i?Er(e,1,i):[]}function Lg(e,i,n){return e&&e.length?(i=n||i===r?1:de(i),Er(e,0,i<0?0:i)):[]}function jg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),i=c-i,Er(e,i<0?0:i,c)):[]}function zg(e,i){return e&&e.length?Fn(e,ee(i,3),!1,!0):[]}function Mg(e,i){return e&&e.length?Fn(e,ee(i,3)):[]}var Ug=ve(function(e){return di(zt(e,1,dt,!0))}),Hg=ve(function(e){var i=Ir(e);return dt(i)&&(i=r),di(zt(e,1,dt,!0),ee(i,2))}),kg=ve(function(e){var i=Ir(e);return i=typeof i=="function"?i:r,di(zt(e,1,dt,!0),r,i)});function Kg(e){return e&&e.length?di(e):[]}function Vg(e,i){return e&&e.length?di(e,ee(i,2)):[]}function Fg(e,i){return i=typeof i=="function"?i:r,e&&e.length?di(e,r,i):[]}function Ko(e){if(!(e&&e.length))return[];var i=0;return e=ui(e,function(n){if(dt(n))return i=Ct(n.length,i),!0}),no(i,function(n){return Qe(e,ro(n))})}function yh(e,i){if(!(e&&e.length))return[];var n=Ko(e);return i==null?n:Qe(n,function(c){return Nt(i,r,c)})}var Bg=ve(function(e,i){return dt(e)?Cs(e,i):[]}),Gg=ve(function(e){return Oo(ui(e,dt))}),Wg=ve(function(e){var i=Ir(e);return dt(i)&&(i=r),Oo(ui(e,dt),ee(i,2))}),Jg=ve(function(e){var i=Ir(e);return i=typeof i=="function"?i:r,Oo(ui(e,dt),r,i)}),Qg=ve(Ko);function Yg(e,i){return Du(e||[],i||[],As)}function Zg(e,i){return Du(e||[],i||[],Ns)}var Xg=ve(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,yh(e,n)});function vh(e){var i=p(e);return i.__chain__=!0,i}function ey(e,i){return i(e),e}function ea(e,i){return i(e)}var ty=Zr(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,l=function(d){return po(d,e)};return i>1||this.__actions__.length||!(c instanceof be)||!Xr(n)?this.thru(l):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:ea,args:[l],thisArg:r}),new _r(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(r),d}))});function ry(){return vh(this)}function iy(){return new _r(this.value(),this.__chain__)}function sy(){this.__values__===r&&(this.__values__=Th(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function ny(){return this}function ay(e){for(var i,n=this;n instanceof Mn;){var c=hh(n);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,i}function oy(){var e=this.__wrapped__;if(e instanceof be){var i=e;return this.__actions__.length&&(i=new be(this)),i=i.reverse(),i.__actions__.push({func:ea,args:[ko],thisArg:r}),new _r(i,this.__chain__)}return this.thru(ko)}function cy(){return Nu(this.__wrapped__,this.__actions__)}var uy=Bn(function(e,i,n){$e.call(e,n)?++e[n]:Qr(e,n,1)});function hy(e,i,n){var c=le(e)?Bc:ed;return n&&Jt(e,i,n)&&(i=r),c(e,ee(i,3))}function ly(e,i){var n=le(e)?ui:yu;return n(e,ee(i,3))}var fy=Vu(lh),py=Vu(fh);function dy(e,i){return zt(ta(e,i),1)}function gy(e,i){return zt(ta(e,i),qe)}function yy(e,i,n){return n=n===r?1:de(n),zt(ta(e,i),n)}function mh(e,i){var n=le(e)?mr:pi;return n(e,ee(i,3))}function wh(e,i){var n=le(e)?qf:gu;return n(e,ee(i,3))}var vy=Bn(function(e,i,n){$e.call(e,n)?e[n].push(i):Qr(e,n,[i])});function my(e,i,n,c){e=tr(e)?e:hs(e),n=n&&!c?de(n):0;var l=e.length;return n<0&&(n=Ct(l+n,0)),aa(e)?n<=l&&e.indexOf(i,n)>-1:!!l&&Zi(e,i,n)>-1}var wy=ve(function(e,i,n){var c=-1,l=typeof i=="function",d=tr(e)?A(e.length):[];return pi(e,function(w){d[++c]=l?Nt(i,w,n):Ts(w,i,n)}),d}),_y=Bn(function(e,i,n){Qr(e,n,i)});function ta(e,i){var n=le(e)?Qe:Eu;return n(e,ee(i,3))}function by(e,i,n,c){return e==null?[]:(le(i)||(i=i==null?[]:[i]),n=c?r:n,le(n)||(n=n==null?[]:[n]),Su(e,i,n))}var Ey=Bn(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function Iy(e,i,n){var c=le(e)?eo:Qc,l=arguments.length<3;return c(e,ee(i,4),n,l,pi)}function xy(e,i,n){var c=le(e)?Lf:Qc,l=arguments.length<3;return c(e,ee(i,4),n,l,gu)}function Py(e,i){var n=le(e)?ui:yu;return n(e,sa(ee(i,3)))}function Sy(e){var i=le(e)?lu:md;return i(e)}function Oy(e,i,n){(n?Jt(e,i,n):i===r)?i=1:i=de(i);var c=le(e)?Jp:wd;return c(e,i)}function Ry(e){var i=le(e)?Qp:bd;return i(e)}function Ay(e){if(e==null)return 0;if(tr(e))return aa(e)?es(e):e.length;var i=Ht(e);return i==ge||i==Ae?e.size:_o(e).length}function Cy(e,i,n){var c=le(e)?to:Ed;return n&&Jt(e,i,n)&&(i=r),c(e,ee(i,3))}var Ty=ve(function(e,i){if(e==null)return[];var n=i.length;return n>1&&Jt(e,i[0],i[1])?i=[]:n>2&&Jt(i[0],i[1],i[2])&&(i=[i[0]]),Su(e,zt(i,1),[])}),ra=lp||function(){return Ee.Date.now()};function $y(e,i){if(typeof i!="function")throw new wr(f);return e=de(e),function(){if(--e<1)return i.apply(this,arguments)}}function _h(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,Yr(e,Q,r,r,r,r,i)}function bh(e,i){var n;if(typeof i!="function")throw new wr(f);return e=de(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Vo=ve(function(e,i,n){var c=se;if(n.length){var l=li(n,cs(Vo));c|=fe}return Yr(e,c,i,n,l)}),Eh=ve(function(e,i,n){var c=se|ne;if(n.length){var l=li(n,cs(Eh));c|=fe}return Yr(i,c,e,n,l)});function Ih(e,i,n){i=n?r:i;var c=Yr(e,ae,r,r,r,r,r,i);return c.placeholder=Ih.placeholder,c}function xh(e,i,n){i=n?r:i;var c=Yr(e,te,r,r,r,r,r,i);return c.placeholder=xh.placeholder,c}function Ph(e,i,n){var c,l,d,w,b,P,q=0,L=!1,z=!1,k=!0;if(typeof e!="function")throw new wr(f);i=xr(i)||0,tt(n)&&(L=!!n.leading,z="maxWait"in n,d=z?Ct(xr(n.maxWait)||0,i):d,k="trailing"in n?!!n.trailing:k);function Y(gt){var Nr=c,ri=l;return c=l=r,q=gt,w=e.apply(ri,Nr),w}function re(gt){return q=gt,b=Ls(me,i),L?Y(gt):w}function ye(gt){var Nr=gt-P,ri=gt-q,Vh=i-Nr;return z?Ut(Vh,d-ri):Vh}function ie(gt){var Nr=gt-P,ri=gt-q;return P===r||Nr>=i||Nr<0||z&&ri>=d}function me(){var gt=ra();if(ie(gt))return Ie(gt);b=Ls(me,ye(gt))}function Ie(gt){return b=r,k&&c?Y(gt):(c=l=r,w)}function dr(){b!==r&&qu(b),q=0,c=P=l=b=r}function Qt(){return b===r?w:Ie(ra())}function gr(){var gt=ra(),Nr=ie(gt);if(c=arguments,l=this,P=gt,Nr){if(b===r)return re(P);if(z)return qu(b),b=Ls(me,i),Y(P)}return b===r&&(b=Ls(me,i)),w}return gr.cancel=dr,gr.flush=Qt,gr}var Ny=ve(function(e,i){return du(e,1,i)}),Dy=ve(function(e,i,n){return du(e,xr(i)||0,n)});function qy(e){return Yr(e,Tt)}function ia(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new wr(f);var n=function(){var c=arguments,l=i?i.apply(this,c):c[0],d=n.cache;if(d.has(l))return d.get(l);var w=e.apply(this,c);return n.cache=d.set(l,w)||d,w};return n.cache=new(ia.Cache||Jr),n}ia.Cache=Jr;function sa(e){if(typeof e!="function")throw new wr(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Ly(e){return bh(2,e)}var jy=Id(function(e,i){i=i.length==1&&le(i[0])?Qe(i[0],lr(ee())):Qe(zt(i,1),lr(ee()));var n=i.length;return ve(function(c){for(var l=-1,d=Ut(c.length,n);++l<d;)c[l]=i[l].call(this,c[l]);return Nt(e,this,c)})}),Fo=ve(function(e,i){var n=li(i,cs(Fo));return Yr(e,fe,r,i,n)}),Sh=ve(function(e,i){var n=li(i,cs(Sh));return Yr(e,pe,r,i,n)}),zy=Zr(function(e,i){return Yr(e,xe,r,r,r,i)});function My(e,i){if(typeof e!="function")throw new wr(f);return i=i===r?i:de(i),ve(e,i)}function Uy(e,i){if(typeof e!="function")throw new wr(f);return i=i==null?0:Ct(de(i),0),ve(function(n){var c=n[i],l=yi(n,0,i);return c&&hi(l,c),Nt(e,this,l)})}function Hy(e,i,n){var c=!0,l=!0;if(typeof e!="function")throw new wr(f);return tt(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Ph(e,i,{leading:c,maxWait:i,trailing:l})}function ky(e){return _h(e,1)}function Ky(e,i){return Fo(Ao(i),e)}function Vy(){if(!arguments.length)return[];var e=arguments[0];return le(e)?e:[e]}function Fy(e){return br(e,D)}function By(e,i){return i=typeof i=="function"?i:r,br(e,D,i)}function Gy(e){return br(e,S|D)}function Wy(e,i){return i=typeof i=="function"?i:r,br(e,S|D,i)}function Jy(e,i){return i==null||pu(e,i,Dt(i))}function $r(e,i){return e===i||e!==e&&i!==i}var Qy=Qn(vo),Yy=Qn(function(e,i){return e>=i}),Mi=wu(function(){return arguments}())?wu:function(e){return ht(e)&&$e.call(e,"callee")&&!nu.call(e,"callee")},le=A.isArray,Zy=Gt?lr(Gt):ad;function tr(e){return e!=null&&na(e.length)&&!ei(e)}function dt(e){return ht(e)&&tr(e)}function Xy(e){return e===!0||e===!1||ht(e)&&Wt(e)==T}var vi=pp||rc,ev=Ar?lr(Ar):od;function tv(e){return ht(e)&&e.nodeType===1&&!js(e)}function rv(e){if(e==null)return!0;if(tr(e)&&(le(e)||typeof e=="string"||typeof e.splice=="function"||vi(e)||us(e)||Mi(e)))return!e.length;var i=Ht(e);if(i==ge||i==Ae)return!e.size;if(qs(e))return!_o(e).length;for(var n in e)if($e.call(e,n))return!1;return!0}function iv(e,i){return $s(e,i)}function sv(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?$s(e,i,r,n):!!c}function Bo(e){if(!ht(e))return!1;var i=Wt(e);return i==E||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!js(e)}function nv(e){return typeof e=="number"&&ou(e)}function ei(e){if(!tt(e))return!1;var i=Wt(e);return i==J||i==oe||i==$||i==lt}function Oh(e){return typeof e=="number"&&e==de(e)}function na(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=G}function tt(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function ht(e){return e!=null&&typeof e=="object"}var Rh=vr?lr(vr):ud;function av(e,i){return e===i||wo(e,i,Lo(i))}function ov(e,i,n){return n=typeof n=="function"?n:r,wo(e,i,Lo(i),n)}function cv(e){return Ah(e)&&e!=+e}function uv(e){if(Bd(e))throw new ue(u);return _u(e)}function hv(e){return e===null}function lv(e){return e==null}function Ah(e){return typeof e=="number"||ht(e)&&Wt(e)==Pe}function js(e){if(!ht(e)||Wt(e)!=_e)return!1;var i=$n(e);if(i===null)return!0;var n=$e.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&Rn.call(n)==op}var Go=Mr?lr(Mr):hd;function fv(e){return Oh(e)&&e>=-G&&e<=G}var Ch=Es?lr(Es):ld;function aa(e){return typeof e=="string"||!le(e)&&ht(e)&&Wt(e)==ke}function pr(e){return typeof e=="symbol"||ht(e)&&Wt(e)==Ke}var us=Ti?lr(Ti):fd;function pv(e){return e===r}function dv(e){return ht(e)&&Ht(e)==Ne}function gv(e){return ht(e)&&Wt(e)==Ve}var yv=Qn(bo),vv=Qn(function(e,i){return e<=i});function Th(e){if(!e)return[];if(tr(e))return aa(e)?Cr(e):er(e);if(xs&&e[xs])return Jf(e[xs]());var i=Ht(e),n=i==ge?oo:i==Ae?Pn:hs;return n(e)}function ti(e){if(!e)return e===0?e:0;if(e=xr(e),e===qe||e===-qe){var i=e<0?-1:1;return i*K}return e===e?e:0}function de(e){var i=ti(e),n=i%1;return i===i?n?i-n:i:0}function $h(e){return e?qi(de(e),0,V):0}function xr(e){if(typeof e=="number")return e;if(pr(e))return H;if(tt(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=tt(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Yc(e);var n=La.test(e);return n||za.test(e)?he(e.slice(2),n?2:8):qa.test(e)?H:+e}function Nh(e){return Hr(e,rr(e))}function mv(e){return e?qi(de(e),-G,G):e===0?e:0}function Ce(e){return e==null?"":fr(e)}var wv=as(function(e,i){if(qs(i)||tr(i)){Hr(i,Dt(i),e);return}for(var n in i)$e.call(i,n)&&As(e,n,i[n])}),Dh=as(function(e,i){Hr(i,rr(i),e)}),oa=as(function(e,i,n,c){Hr(i,rr(i),e,c)}),_v=as(function(e,i,n,c){Hr(i,Dt(i),e,c)}),bv=Zr(po);function Ev(e,i){var n=ns(e);return i==null?n:fu(n,i)}var Iv=ve(function(e,i){e=Ue(e);var n=-1,c=i.length,l=c>2?i[2]:r;for(l&&Jt(i[0],i[1],l)&&(c=1);++n<c;)for(var d=i[n],w=rr(d),b=-1,P=w.length;++b<P;){var q=w[b],L=e[q];(L===r||$r(L,rs[q])&&!$e.call(e,q))&&(e[q]=d[q])}return e}),xv=ve(function(e){return e.push(r,Yu),Nt(qh,r,e)});function Pv(e,i){return Gc(e,ee(i,3),Ur)}function Sv(e,i){return Gc(e,ee(i,3),yo)}function Ov(e,i){return e==null?e:go(e,ee(i,3),rr)}function Rv(e,i){return e==null?e:vu(e,ee(i,3),rr)}function Av(e,i){return e&&Ur(e,ee(i,3))}function Cv(e,i){return e&&yo(e,ee(i,3))}function Tv(e){return e==null?[]:kn(e,Dt(e))}function $v(e){return e==null?[]:kn(e,rr(e))}function Wo(e,i,n){var c=e==null?r:Li(e,i);return c===r?n:c}function Nv(e,i){return e!=null&&eh(e,i,rd)}function Jo(e,i){return e!=null&&eh(e,i,id)}var Dv=Bu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=An.call(i)),e[i]=n},Yo(ir)),qv=Bu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=An.call(i)),$e.call(e,i)?e[i].push(n):e[i]=[n]},ee),Lv=ve(Ts);function Dt(e){return tr(e)?hu(e):_o(e)}function rr(e){return tr(e)?hu(e,!0):pd(e)}function jv(e,i){var n={};return i=ee(i,3),Ur(e,function(c,l,d){Qr(n,i(c,l,d),c)}),n}function zv(e,i){var n={};return i=ee(i,3),Ur(e,function(c,l,d){Qr(n,l,i(c,l,d))}),n}var Mv=as(function(e,i,n){Kn(e,i,n)}),qh=as(function(e,i,n,c){Kn(e,i,n,c)}),Uv=Zr(function(e,i){var n={};if(e==null)return n;var c=!1;i=Qe(i,function(d){return d=gi(d,e),c||(c=d.length>1),d}),Hr(e,Do(e),n),c&&(n=br(n,S|R|D,Dd));for(var l=i.length;l--;)So(n,i[l]);return n});function Hv(e,i){return Lh(e,sa(ee(i)))}var kv=Zr(function(e,i){return e==null?{}:gd(e,i)});function Lh(e,i){if(e==null)return{};var n=Qe(Do(e),function(c){return[c]});return i=ee(i),Ou(e,n,function(c,l){return i(c,l[0])})}function Kv(e,i,n){i=gi(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var d=e==null?r:e[kr(i[c])];d===r&&(c=l,d=n),e=ei(d)?d.call(e):d}return e}function Vv(e,i,n){return e==null?e:Ns(e,i,n)}function Fv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Ns(e,i,n,c)}var jh=Ju(Dt),zh=Ju(rr);function Bv(e,i,n){var c=le(e),l=c||vi(e)||us(e);if(i=ee(i,4),n==null){var d=e&&e.constructor;l?n=c?new d:[]:tt(e)?n=ei(d)?ns($n(e)):{}:n={}}return(l?mr:Ur)(e,function(w,b,P){return i(n,w,b,P)}),n}function Gv(e,i){return e==null?!0:So(e,i)}function Wv(e,i,n){return e==null?e:$u(e,i,Ao(n))}function Jv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:$u(e,i,Ao(n),c)}function hs(e){return e==null?[]:ao(e,Dt(e))}function Qv(e){return e==null?[]:ao(e,rr(e))}function Yv(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=xr(n),n=n===n?n:0),i!==r&&(i=xr(i),i=i===i?i:0),qi(xr(e),i,n)}function Zv(e,i,n){return i=ti(i),n===r?(n=i,i=0):n=ti(n),e=xr(e),sd(e,i,n)}function Xv(e,i,n){if(n&&typeof n!="boolean"&&Jt(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ti(e),i===r?(i=e,e=0):i=ti(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var l=cu();return Ut(e+l*(i-e+ze("1e-"+((l+"").length-1))),i)}return Io(e,i)}var em=os(function(e,i,n){return i=i.toLowerCase(),e+(n?Mh(i):i)});function Mh(e){return Qo(Ce(e).toLowerCase())}function Uh(e){return e=Ce(e),e&&e.replace(Br,Vf).replace(Ya,"")}function tm(e,i,n){e=Ce(e),i=fr(i);var c=e.length;n=n===r?c:qi(de(n),0,c);var l=n;return n-=i.length,n>=0&&e.slice(n,l)==i}function rm(e){return e=Ce(e),e&&We.test(e)?e.replace(Si,Ff):e}function im(e){return e=Ce(e),e&&bt.test(e)?e.replace(ot,"\\$&"):e}var sm=os(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),nm=os(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),am=Ku("toLowerCase");function om(e,i,n){e=Ce(e),i=de(i);var c=i?es(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return Jn(Ln(l),n)+e+Jn(qn(l),n)}function cm(e,i,n){e=Ce(e),i=de(i);var c=i?es(e):0;return i&&c<i?e+Jn(i-c,n):e}function um(e,i,n){e=Ce(e),i=de(i);var c=i?es(e):0;return i&&c<i?Jn(i-c,n)+e:e}function hm(e,i,n){return n||i==null?i=0:i&&(i=+i),vp(Ce(e).replace(ct,""),i||0)}function lm(e,i,n){return(n?Jt(e,i,n):i===r)?i=1:i=de(i),xo(Ce(e),i)}function fm(){var e=arguments,i=Ce(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var pm=os(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function dm(e,i,n){return n&&typeof n!="number"&&Jt(e,i,n)&&(i=n=r),n=n===r?V:n>>>0,n?(e=Ce(e),e&&(typeof i=="string"||i!=null&&!Go(i))&&(i=fr(i),!i&&Xi(e))?yi(Cr(e),0,n):e.split(i,n)):[]}var gm=os(function(e,i,n){return e+(n?" ":"")+Qo(i)});function ym(e,i,n){return e=Ce(e),n=n==null?0:qi(de(n),0,e.length),i=fr(i),e.slice(n,n+i.length)==i}function vm(e,i,n){var c=p.templateSettings;n&&Jt(e,i,n)&&(i=r),e=Ce(e),i=oa({},i,c,Qu);var l=oa({},i.imports,c.imports,Qu),d=Dt(l),w=ao(l,d),b,P,q=0,L=i.interpolate||Fi,z="__p += '",k=co((i.escape||Fi).source+"|"+L.source+"|"+(L===et?Da:Fi).source+"|"+(i.evaluate||Fi).source+"|$","g"),Y="//# sourceURL="+($e.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Za+"]")+`
`;e.replace(k,function(ie,me,Ie,dr,Qt,gr){return Ie||(Ie=dr),z+=e.slice(q,gr).replace(Ua,Bf),me&&(b=!0,z+=`' +
__e(`+me+`) +
'`),Qt&&(P=!0,z+=`';
`+Qt+`;
__p += '`),Ie&&(z+=`' +
((__t = (`+Ie+`)) == null ? '' : __t) +
'`),q=gr+ie.length,ie}),z+=`';
`;var re=$e.call(i,"variable")&&i.variable;if(!re)z=`with (obj) {
`+z+`
}
`;else if($a.test(re))throw new ue(y);z=(P?z.replace(jr,""):z).replace(Bt,"$1").replace(Fr,"$1;"),z="function("+(re||"obj")+`) {
`+(re?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+z+`return __p
}`;var ye=kh(function(){return Re(d,Y+"return "+z).apply(r,w)});if(ye.source=z,Bo(ye))throw ye;return ye}function mm(e){return Ce(e).toLowerCase()}function wm(e){return Ce(e).toUpperCase()}function _m(e,i,n){if(e=Ce(e),e&&(n||i===r))return Yc(e);if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Cr(i),d=Zc(c,l),w=Xc(c,l)+1;return yi(c,d,w).join("")}function bm(e,i,n){if(e=Ce(e),e&&(n||i===r))return e.slice(0,tu(e)+1);if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Xc(c,Cr(i))+1;return yi(c,0,l).join("")}function Em(e,i,n){if(e=Ce(e),e&&(n||i===r))return e.replace(ct,"");if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Zc(c,Cr(i));return yi(c,l).join("")}function Im(e,i){var n=yt,c=Yt;if(tt(i)){var l="separator"in i?i.separator:l;n="length"in i?de(i.length):n,c="omission"in i?fr(i.omission):c}e=Ce(e);var d=e.length;if(Xi(e)){var w=Cr(e);d=w.length}if(n>=d)return e;var b=n-es(c);if(b<1)return c;var P=w?yi(w,0,b).join(""):e.slice(0,b);if(l===r)return P+c;if(w&&(b+=P.length-b),Go(l)){if(e.slice(b).search(l)){var q,L=P;for(l.global||(l=co(l.source,Ce(yr.exec(l))+"g")),l.lastIndex=0;q=l.exec(L);)var z=q.index;P=P.slice(0,z===r?b:z)}}else if(e.indexOf(fr(l),b)!=b){var k=P.lastIndexOf(l);k>-1&&(P=P.slice(0,k))}return P+c}function xm(e){return e=Ce(e),e&&st.test(e)?e.replace(oi,Xf):e}var Pm=os(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),Qo=Ku("toUpperCase");function Hh(e,i,n){return e=Ce(e),i=n?r:i,i===r?Wf(e)?rp(e):Mf(e):e.match(i)||[]}var kh=ve(function(e,i){try{return Nt(e,r,i)}catch(n){return Bo(n)?n:new ue(n)}}),Sm=Zr(function(e,i){return mr(i,function(n){n=kr(n),Qr(e,n,Vo(e[n],e))}),e});function Om(e){var i=e==null?0:e.length,n=ee();return e=i?Qe(e,function(c){if(typeof c[1]!="function")throw new wr(f);return[n(c[0]),c[1]]}):[],ve(function(c){for(var l=-1;++l<i;){var d=e[l];if(Nt(d[0],this,c))return Nt(d[1],this,c)}})}function Rm(e){return Xp(br(e,S))}function Yo(e){return function(){return e}}function Am(e,i){return e==null||e!==e?i:e}var Cm=Fu(),Tm=Fu(!0);function ir(e){return e}function Zo(e){return bu(typeof e=="function"?e:br(e,S))}function $m(e){return Iu(br(e,S))}function Nm(e,i){return xu(e,br(i,S))}var Dm=ve(function(e,i){return function(n){return Ts(n,e,i)}}),qm=ve(function(e,i){return function(n){return Ts(e,n,i)}});function Xo(e,i,n){var c=Dt(i),l=kn(i,c);n==null&&!(tt(i)&&(l.length||!c.length))&&(n=i,i=e,e=this,l=kn(i,Dt(i)));var d=!(tt(n)&&"chain"in n)||!!n.chain,w=ei(e);return mr(l,function(b){var P=i[b];e[b]=P,w&&(e.prototype[b]=function(){var q=this.__chain__;if(d||q){var L=e(this.__wrapped__),z=L.__actions__=er(this.__actions__);return z.push({func:P,args:arguments,thisArg:e}),L.__chain__=q,L}return P.apply(e,hi([this.value()],arguments))})}),e}function Lm(){return Ee._===this&&(Ee._=cp),this}function ec(){}function jm(e){return e=de(e),ve(function(i){return Pu(i,e)})}var zm=To(Qe),Mm=To(Bc),Um=To(to);function Kh(e){return zo(e)?ro(kr(e)):yd(e)}function Hm(e){return function(i){return e==null?r:Li(e,i)}}var km=Gu(),Km=Gu(!0);function tc(){return[]}function rc(){return!1}function Vm(){return{}}function Fm(){return""}function Bm(){return!0}function Gm(e,i){if(e=de(e),e<1||e>G)return[];var n=V,c=Ut(e,V);i=ee(i),e-=V;for(var l=no(c,i);++n<e;)i(n);return l}function Wm(e){return le(e)?Qe(e,kr):pr(e)?[e]:er(uh(Ce(e)))}function Jm(e){var i=++ap;return Ce(e)+i}var Qm=Wn(function(e,i){return e+i},0),Ym=$o("ceil"),Zm=Wn(function(e,i){return e/i},1),Xm=$o("floor");function e0(e){return e&&e.length?Hn(e,ir,vo):r}function t0(e,i){return e&&e.length?Hn(e,ee(i,2),vo):r}function r0(e){return Jc(e,ir)}function i0(e,i){return Jc(e,ee(i,2))}function s0(e){return e&&e.length?Hn(e,ir,bo):r}function n0(e,i){return e&&e.length?Hn(e,ee(i,2),bo):r}var a0=Wn(function(e,i){return e*i},1),o0=$o("round"),c0=Wn(function(e,i){return e-i},0);function u0(e){return e&&e.length?so(e,ir):0}function h0(e,i){return e&&e.length?so(e,ee(i,2)):0}return p.after=$y,p.ary=_h,p.assign=wv,p.assignIn=Dh,p.assignInWith=oa,p.assignWith=_v,p.at=bv,p.before=bh,p.bind=Vo,p.bindAll=Sm,p.bindKey=Eh,p.castArray=Vy,p.chain=vh,p.chunk=Xd,p.compact=eg,p.concat=tg,p.cond=Om,p.conforms=Rm,p.constant=Yo,p.countBy=uy,p.create=Ev,p.curry=Ih,p.curryRight=xh,p.debounce=Ph,p.defaults=Iv,p.defaultsDeep=xv,p.defer=Ny,p.delay=Dy,p.difference=rg,p.differenceBy=ig,p.differenceWith=sg,p.drop=ng,p.dropRight=ag,p.dropRightWhile=og,p.dropWhile=cg,p.fill=ug,p.filter=ly,p.flatMap=dy,p.flatMapDeep=gy,p.flatMapDepth=yy,p.flatten=ph,p.flattenDeep=hg,p.flattenDepth=lg,p.flip=qy,p.flow=Cm,p.flowRight=Tm,p.fromPairs=fg,p.functions=Tv,p.functionsIn=$v,p.groupBy=vy,p.initial=dg,p.intersection=gg,p.intersectionBy=yg,p.intersectionWith=vg,p.invert=Dv,p.invertBy=qv,p.invokeMap=wy,p.iteratee=Zo,p.keyBy=_y,p.keys=Dt,p.keysIn=rr,p.map=ta,p.mapKeys=jv,p.mapValues=zv,p.matches=$m,p.matchesProperty=Nm,p.memoize=ia,p.merge=Mv,p.mergeWith=qh,p.method=Dm,p.methodOf=qm,p.mixin=Xo,p.negate=sa,p.nthArg=jm,p.omit=Uv,p.omitBy=Hv,p.once=Ly,p.orderBy=by,p.over=zm,p.overArgs=jy,p.overEvery=Mm,p.overSome=Um,p.partial=Fo,p.partialRight=Sh,p.partition=Ey,p.pick=kv,p.pickBy=Lh,p.property=Kh,p.propertyOf=Hm,p.pull=bg,p.pullAll=gh,p.pullAllBy=Eg,p.pullAllWith=Ig,p.pullAt=xg,p.range=km,p.rangeRight=Km,p.rearg=zy,p.reject=Py,p.remove=Pg,p.rest=My,p.reverse=ko,p.sampleSize=Oy,p.set=Vv,p.setWith=Fv,p.shuffle=Ry,p.slice=Sg,p.sortBy=Ty,p.sortedUniq=Ng,p.sortedUniqBy=Dg,p.split=dm,p.spread=Uy,p.tail=qg,p.take=Lg,p.takeRight=jg,p.takeRightWhile=zg,p.takeWhile=Mg,p.tap=ey,p.throttle=Hy,p.thru=ea,p.toArray=Th,p.toPairs=jh,p.toPairsIn=zh,p.toPath=Wm,p.toPlainObject=Nh,p.transform=Bv,p.unary=ky,p.union=Ug,p.unionBy=Hg,p.unionWith=kg,p.uniq=Kg,p.uniqBy=Vg,p.uniqWith=Fg,p.unset=Gv,p.unzip=Ko,p.unzipWith=yh,p.update=Wv,p.updateWith=Jv,p.values=hs,p.valuesIn=Qv,p.without=Bg,p.words=Hh,p.wrap=Ky,p.xor=Gg,p.xorBy=Wg,p.xorWith=Jg,p.zip=Qg,p.zipObject=Yg,p.zipObjectDeep=Zg,p.zipWith=Xg,p.entries=jh,p.entriesIn=zh,p.extend=Dh,p.extendWith=oa,Xo(p,p),p.add=Qm,p.attempt=kh,p.camelCase=em,p.capitalize=Mh,p.ceil=Ym,p.clamp=Yv,p.clone=Fy,p.cloneDeep=Gy,p.cloneDeepWith=Wy,p.cloneWith=By,p.conformsTo=Jy,p.deburr=Uh,p.defaultTo=Am,p.divide=Zm,p.endsWith=tm,p.eq=$r,p.escape=rm,p.escapeRegExp=im,p.every=hy,p.find=fy,p.findIndex=lh,p.findKey=Pv,p.findLast=py,p.findLastIndex=fh,p.findLastKey=Sv,p.floor=Xm,p.forEach=mh,p.forEachRight=wh,p.forIn=Ov,p.forInRight=Rv,p.forOwn=Av,p.forOwnRight=Cv,p.get=Wo,p.gt=Qy,p.gte=Yy,p.has=Nv,p.hasIn=Jo,p.head=dh,p.identity=ir,p.includes=my,p.indexOf=pg,p.inRange=Zv,p.invoke=Lv,p.isArguments=Mi,p.isArray=le,p.isArrayBuffer=Zy,p.isArrayLike=tr,p.isArrayLikeObject=dt,p.isBoolean=Xy,p.isBuffer=vi,p.isDate=ev,p.isElement=tv,p.isEmpty=rv,p.isEqual=iv,p.isEqualWith=sv,p.isError=Bo,p.isFinite=nv,p.isFunction=ei,p.isInteger=Oh,p.isLength=na,p.isMap=Rh,p.isMatch=av,p.isMatchWith=ov,p.isNaN=cv,p.isNative=uv,p.isNil=lv,p.isNull=hv,p.isNumber=Ah,p.isObject=tt,p.isObjectLike=ht,p.isPlainObject=js,p.isRegExp=Go,p.isSafeInteger=fv,p.isSet=Ch,p.isString=aa,p.isSymbol=pr,p.isTypedArray=us,p.isUndefined=pv,p.isWeakMap=dv,p.isWeakSet=gv,p.join=mg,p.kebabCase=sm,p.last=Ir,p.lastIndexOf=wg,p.lowerCase=nm,p.lowerFirst=am,p.lt=yv,p.lte=vv,p.max=e0,p.maxBy=t0,p.mean=r0,p.meanBy=i0,p.min=s0,p.minBy=n0,p.stubArray=tc,p.stubFalse=rc,p.stubObject=Vm,p.stubString=Fm,p.stubTrue=Bm,p.multiply=a0,p.nth=_g,p.noConflict=Lm,p.noop=ec,p.now=ra,p.pad=om,p.padEnd=cm,p.padStart=um,p.parseInt=hm,p.random=Xv,p.reduce=Iy,p.reduceRight=xy,p.repeat=lm,p.replace=fm,p.result=Kv,p.round=o0,p.runInContext=x,p.sample=Sy,p.size=Ay,p.snakeCase=pm,p.some=Cy,p.sortedIndex=Og,p.sortedIndexBy=Rg,p.sortedIndexOf=Ag,p.sortedLastIndex=Cg,p.sortedLastIndexBy=Tg,p.sortedLastIndexOf=$g,p.startCase=gm,p.startsWith=ym,p.subtract=c0,p.sum=u0,p.sumBy=h0,p.template=vm,p.times=Gm,p.toFinite=ti,p.toInteger=de,p.toLength=$h,p.toLower=mm,p.toNumber=xr,p.toSafeInteger=mv,p.toString=Ce,p.toUpper=wm,p.trim=_m,p.trimEnd=bm,p.trimStart=Em,p.truncate=Im,p.unescape=xm,p.uniqueId=Jm,p.upperCase=Pm,p.upperFirst=Qo,p.each=mh,p.eachRight=wh,p.first=dh,Xo(p,function(){var e={};return Ur(p,function(i,n){$e.call(p.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),p.VERSION=s,mr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),mr(["drop","take"],function(e,i){be.prototype[e]=function(n){n=n===r?1:Ct(de(n),0);var c=this.__filtered__&&!i?new be(this):this.clone();return c.__filtered__?c.__takeCount__=Ut(n,c.__takeCount__):c.__views__.push({size:Ut(n,V),type:e+(c.__dir__<0?"Right":"")}),c},be.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),mr(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==M||n==Ge;be.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ee(l,3),type:n}),d.__filtered__=d.__filtered__||c,d}}),mr(["head","last"],function(e,i){var n="take"+(i?"Right":"");be.prototype[e]=function(){return this[n](1).value()[0]}}),mr(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");be.prototype[e]=function(){return this.__filtered__?new be(this):this[n](1)}}),be.prototype.compact=function(){return this.filter(ir)},be.prototype.find=function(e){return this.filter(e).head()},be.prototype.findLast=function(e){return this.reverse().find(e)},be.prototype.invokeMap=ve(function(e,i){return typeof e=="function"?new be(this):this.map(function(n){return Ts(n,e,i)})}),be.prototype.reject=function(e){return this.filter(sa(ee(e)))},be.prototype.slice=function(e,i){e=de(e);var n=this;return n.__filtered__&&(e>0||i<0)?new be(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=de(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},be.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},be.prototype.toArray=function(){return this.take(V)},Ur(be.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=p[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);l&&(p.prototype[i]=function(){var w=this.__wrapped__,b=c?[1]:arguments,P=w instanceof be,q=b[0],L=P||le(w),z=function(me){var Ie=l.apply(p,hi([me],b));return c&&k?Ie[0]:Ie};L&&n&&typeof q=="function"&&q.length!=1&&(P=L=!1);var k=this.__chain__,Y=!!this.__actions__.length,re=d&&!k,ye=P&&!Y;if(!d&&L){w=ye?w:new be(this);var ie=e.apply(w,b);return ie.__actions__.push({func:ea,args:[z],thisArg:r}),new _r(ie,k)}return re&&ye?e.apply(this,b):(ie=this.thru(z),re?c?ie.value()[0]:ie.value():ie)})}),mr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Sn[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(le(d)?d:[],l)}return this[n](function(w){return i.apply(le(w)?w:[],l)})}}),Ur(be.prototype,function(e,i){var n=p[i];if(n){var c=n.name+"";$e.call(ss,c)||(ss[c]=[]),ss[c].push({name:i,func:n})}}),ss[Gn(r,ne).name]=[{name:"wrapper",func:r}],be.prototype.clone=xp,be.prototype.reverse=Pp,be.prototype.value=Sp,p.prototype.at=ty,p.prototype.chain=ry,p.prototype.commit=iy,p.prototype.next=sy,p.prototype.plant=ay,p.prototype.reverse=oy,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=cy,p.prototype.first=p.prototype.head,xs&&(p.prototype[xs]=ny),p},ts=ip();pt?((pt.exports=ts)._=ts,Me._=ts):Ee._=ts}).call(Vs)})(Ac,Ac.exports);var oI=Object.defineProperty,cI=Object.defineProperties,uI=Object.getOwnPropertyDescriptors,zl=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,lI=Object.prototype.propertyIsEnumerable,Ml=(o,t,r)=>t in o?oI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,da=(o,t)=>{for(var r in t||(t={}))hI.call(t,r)&&Ml(o,r,t[r]);if(zl)for(var r of zl(t))lI.call(t,r)&&Ml(o,r,t[r]);return o},fI=(o,t)=>cI(o,uI(t));function Ei(o,t,r){var s;const a=Q0(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${aI}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Vi(o){return o.includes(":")?o.split(":")[1]:o}function $f(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function pI(o,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function dI(o={},t={}){const r=Ul(o),s=Ul(t);return Ac.exports.merge(r,s)}function Ul(o){var t,r,s,a;const u={};if(!va(o))return u;for(const[f,y]of Object.entries(o)){const m=Xl(f)?[f]:y.chains,g=y.methods||[],_=y.events||[],S=y.rpcMap||{},R=Fs(f);u[R]=fI(da(da({},u[R]),y),{chains:sc(m,(t=u[R])==null?void 0:t.chains),methods:sc(g,(r=u[R])==null?void 0:r.methods),events:sc(_,(s=u[R])==null?void 0:s.events),rpcMap:da(da({},S),(a=u[R])==null?void 0:a.rpcMap)})}return u}function gI(o){return o.includes(":")?o.split(":")[2]:o}function yI(o){const t={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],f=s.accounts||[],y=Xl(r)?[r]:s.chains?s.chains:$f(s.accounts);t[r]={chains:y,methods:a,events:u,accounts:f}}return t}function gc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const Nf={},Ye=o=>Nf[o],yc=(o,t)=>{Nf[o]=t};class vI{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Vi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ei(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new xi(new Ii(s,Ye("disableProviderPing")))}}class mI{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Ei(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new xi(new Ii(s,Ye("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(Vi(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class wI{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Vi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ei(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new xi(new Ii(s,Ye("disableProviderPing")))}}class _I{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Vi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ei(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new xi(new Ii(s,Ye("disableProviderPing")))}}class bI{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=Vi(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new xi(new Ii(s,Ye("disableProviderPing")))}}class EI{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Vi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ei(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new xi(new Ii(s,Ye("disableProviderPing")))}}class II{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Vi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ei(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new xi(new Ii(s,Ye("disableProviderPing")))}}class xI{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Ei(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(ai.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ei(t,this.namespace);return typeof s>"u"?void 0:new xi(new Ii(s,Ye("disableProviderPing")))}}var PI=Object.defineProperty,SI=Object.defineProperties,OI=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,RI=Object.prototype.hasOwnProperty,AI=Object.prototype.propertyIsEnumerable,kl=(o,t,r)=>t in o?PI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,ga=(o,t)=>{for(var r in t||(t={}))RI.call(t,r)&&kl(o,r,t[r]);if(Hl)for(var r of Hl(t))AI.call(t,r)&&kl(o,r,t[r]);return o},vc=(o,t)=>SI(o,OI(t));class Vc{constructor(t){this.events=new Lc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ra(Aa({level:(t==null?void 0:t.logger)||Ll})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Vc(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ga({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){const a=new Date().getTime();this.request(t,s).then(u=>r(null,Pa(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:kt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=yI(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Cf)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(vs(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await rI.init({logger:this.providerOpts.logger||Ll,relayUrl:this.providerOpts.relayUrl||iI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Fs(r)))];yc("client",this.client),yc("events",this.events),yc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=pI(r,this.session),a=$f(s),u=dI(this.namespaces,this.optionalNamespaces),f=vc(ga({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new mI({namespace:f});break;case"solana":this.rpcProviders[r]=new wI({namespace:f});break;case"cosmos":this.rpcProviders[r]=new _I({namespace:f});break;case"polkadot":this.rpcProviders[r]=new vI({namespace:f});break;case"cip34":this.rpcProviders[r]=new bI({namespace:f});break;case"elrond":this.rpcProviders[r]=new EI({namespace:f});break;case"multiversx":this.rpcProviders[r]=new II({namespace:f});break;case"near":this.rpcProviders[r]=new xI({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&vs(a)&&this.events.emit("accountsChanged",a.map(gI))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,f=Fs(a),y=gc(a)!==gc(u)?`${f}:${gc(u)}`:a;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=vc(ga({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",vc(ga({},kt("USER_DISCONNECTED")),{data:t.topic}))}),this.on(ai.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(f=>Fs(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Fs(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${jl}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${jl}/${t}`)}}const CI=Vc,TI="wc",$I="ethereum_provider",NI=`${TI}@2:${$I}:`,DI="https://rpc.walletconnect.com/v1/",Cc=["eth_sendTransaction","personal_sign"],qI=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Tc=["chainChanged","accountsChanged"],LI=["chainChanged","accountsChanged","message","disconnect","connect"];var jI=Object.defineProperty,zI=Object.defineProperties,MI=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,UI=Object.prototype.hasOwnProperty,HI=Object.prototype.propertyIsEnumerable,Vl=(o,t,r)=>t in o?jI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Gs=(o,t)=>{for(var r in t||(t={}))UI.call(t,r)&&Vl(o,r,t[r]);if(Kl)for(var r of Kl(t))HI.call(t,r)&&Vl(o,r,t[r]);return o},Fl=(o,t)=>zI(o,MI(t));function Ea(o){return Number(o[0].split(":")[1])}function mc(o){return`0x${o.toString(16)}`}function kI(o){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:f,rpcMap:y}=o;if(!vs(t))throw new Error("Invalid chains");const m={chains:t,methods:s||Cc,events:u||Tc,rpcMap:Gs({},t.length?{[Ea(t)]:y[Ea(t)]}:{})},g=u==null?void 0:u.filter(D=>!Tc.includes(D)),_=s==null?void 0:s.filter(D=>!Cc.includes(D));if(!r&&!f&&!a&&!(g!=null&&g.length)&&!(_!=null&&_.length))return{required:t.length?m:void 0};const S=(g==null?void 0:g.length)&&(_==null?void 0:_.length)||!r,R={chains:[...new Set(S?m.chains.concat(r||[]):r)],methods:[...new Set(m.methods.concat(a!=null&&a.length?a:qI))],events:[...new Set(m.events.concat(f!=null&&f.length?f:LI))],rpcMap:y};return{required:t.length?m:void 0,optional:r.length?R:void 0}}class Fc{constructor(){this.events=new Sr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=NI,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Fc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=kI(this.rpc);try{const a=await new Promise(async(f,y)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(g=>{!g.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Fl(Gs({namespaces:Gs({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(g=>{f(g)}).catch(g=>{y(new Error(g.message))})});if(!a)return;const u=Y0(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:mc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",mc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Fl(Gs({},kt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",mc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=a.concat(u);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(t==null?void 0:t.methods)||Cc:[],m=a.length?(t==null?void 0:t.events)||Tc:[],g=(t==null?void 0:t.optionalMethods)||[],_=(t==null?void 0:t.optionalEvents)||[],S=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),R=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(D=>this.formatChainId(D)),optionalChains:u.map(D=>this.formatChainId(D)),methods:y,events:m,optionalMethods:g,optionalEvents:_,rpcMap:S,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:R,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Ea(this.rpc.chains):Ea(this.rpc.optionalChains),this.signer=await CI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Z0(()=>import("./index-BPVoLLHE.js").then(a=>a.i),__vite__mapDeps([0,1,2]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Gs({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&vs(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&vs(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${DI}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const nx=Fc;export{nx as EthereumProvider,LI as OPTIONAL_EVENTS,qI as OPTIONAL_METHODS,Tc as REQUIRED_EVENTS,Cc as REQUIRED_METHODS,Fc as default};
